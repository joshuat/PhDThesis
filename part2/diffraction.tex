\chapter{Ultrafast Electron Diffractive Imaging}\label{chapter:diffraction}

One of the central motivations for the development of \gls{caeis} is their potential use as an electron source for the creation of molecular movies~\cite{van_der_geer_ultracold_2009}.
One of the stepping stones towards molecular movies is achieving single-shot ultrafast diffractive imaging and single-shot electron diffraction from gold nanofoils has already been demonstrated~\cite{speirs_single-shot_2015}.
If care is taken with the ionisation pathways the \glspl{caes} is able to produce ultrafast bunches of cold electrons, as discussed in Section~\ref{section:two_stage_ionisation}~\cite{speirs_single-shot_2015,speirs_identification_2017,speirs_electron_2017}.
With improvements to the bunch current the next generation of \glspl{caes} will have the potential to do Bragg diffraction from simple samples that is both single-shot and ultrafast and eventually \gls{cdi}~\cite{mcculloch_cold_2016}.

Previous results from the \gls{caes} have shown diffraction from large crystalline samples using traditional crystallographic techniques~\cite{speirs_single-shot_2015,speirs_electron_2017}.
This chapter describes extensions to those results, namely demonstrating ultrafast diffraction from gold nanofoils and using a additional voltage bias applied to the sample holder to achieve the required beam energy for diffraction from polycrystalline aluminium.

\section{Crystallography}

Crystallography refers the the science of diffractive imaging from crystals and has been studied for over \unit[100]{years}, being the subject of the 1915 Nobel prize in physics~\cite{bragg_structure_1913}.
Crystallography has been an highly productive science generating numerous Nobel prizes and producing results such as the structure of DNA~\cite{franklin_structure_1953,dennis_eternal_2003}.
There are over 100,000 entries in the Protein Data Bank from from X-ray crystallography~\cite{noauthor_pdb_nodate}.
Crystallographic techniques have been under constant development and refinement since their inception.
The majority of crystallography to date has been performed using X-rays however relatively recent developments have utilised electrons as electron diffraction techniques are more versatile than those of X-rays~\cite{cowley_electron_1992}.

Due to the mature understanding of crystallographic techniques, crystallography is ideal for the first steps in demonstrating the capabilities of \glspl{caes}.
While the \gls{caes} is able to operate in \gls{cw} mode the performance with this apparatus has been optimised for pulse mode (see Section~\ref{section:pulse_vs_continuous}) and thus the results described in this chapter have been taken with pulsed bunches of electrons.

\subsection{Theory}

Crystalline structures consist of repeated sub-structures, unit cells, each with identical arrangements of atoms.
A perfect infinite crystal can be described as a lattice of unit cells where a set of basis vectors, $\mathbf{\hat{a}}$, $\mathbf{\hat{b}}$, and $\mathbf{\hat{c}}$, can be used to describe translations,
\begin{equation}
\mathbf{t} = u\mathbf{\hat{a}} + v\mathbf{\hat{b}} + w\mathbf{\hat{c}},
\end{equation}
where the integer coordinates $u$, $v$ and $w$ describe translation by a number of unit cells along each basis vector from some origin.
A primitive unit cell may contain one or more atoms and symmetry is sometimes more apparent if the unit cell consists of multiple primitive unit cells.

When a wave interacting with the crystal lattice interacts with a specific atom in every unit cell then the reflected waves will be in phase which creates a maxima in the diffraction pattern.
These planes in the crystal that these atoms line up on can be described by points in the reciprocal lattice.
The reciprocal lattice is described by the reciprocal lattice basis vectors, $\mathbf{\hat{a}^*}$, $\mathbf{\hat{b}^*}$, and $\mathbf{\hat{c}^*}$, where
\begin{align}
\mathbf{\hat{a}^*}&=\frac{2\pi\:\mathbf{\hat{b}}\times\mathbf{\hat{c}}}{\mathbf{\hat{a}}\cdot (\mathbf{\hat{b}} \times \mathbf{\hat{c}})},  &  \mathbf{\hat{b}^*}&=\frac{2\pi\:\mathbf{\hat{c}}\times\mathbf{\hat{a}}}{\mathbf{\hat{a}}\cdot (\mathbf{\hat{b}} \times \mathbf{\hat{c}})},  &  \mathbf{\hat{c}^*}&=\frac{2\pi\:\mathbf{\hat{a}}\times\mathbf{\hat{b}}}{\mathbf{\hat{a}}\cdot (\mathbf{\hat{b}} \times \mathbf{\hat{c}})}.
\end{align}
The $2\pi$ originates from the convention chosen for the wave-vector, $|\mathbf{k}|=2\pi/\lambda$. The reciprocal lattice vector is thus,
\begin{equation}
\mathbf{g} = h\mathbf{\hat{a}^*} + k\mathbf{\hat{b}^*} + l\mathbf{\hat{c}^*},
\end{equation}
where the integers $h$, $k$, and $l$ are known as the Miller indices.

Scattering events can be described by, $\mathbf{q}$, the scattering vector, which is the difference between the initial and final wavevectors, $\mathbf{k_0}$ and $\mathbf{k}$;
\begin{equation}
\mathbf{q} = \mathbf{k} - \mathbf{k_0}.
\end{equation}
In the case of elastically scatter waves, $|\mathbf{k}| = |\mathbf{k_0}|$.
Constructive interference occurs only where $\mathbf{q}$ is equal to a reciprocal lattice vector, so the scattering condition for crystals is
\begin{equation}
\mathbf{q} = \mathbf{g}.
\end{equation}
The relationship between the scattering vector and the scattering angle is
\begin{equation}\label{equation:diffraction_angle}
\left|\mathbf{q}\right| = 2\left|\mathbf{k_0}\right|\sin(\theta)
\end{equation}
where $\theta$ is the half angle between the initial and final wavevectors.
Due to the wavevector convention used the relation between real and reciprocal space distances is
\begin{equation}\label{equation:diffraction_distance}
\left|\mathbf{g}\right| = \frac{2\pi}{d_{hkl}},
\end{equation}
where $d_{hkl}$ is the distance between the set of planes described by the subscripted Miller indices.

If we combine Equations~\ref{equation:diffraction_angle} and \ref{equation:diffraction_distance} then we get the Bragg condition,
\begin{equation}
2d_{hkl}\sin\theta = n\lambda,
\end{equation}
where $n$ is the diffraction order.

The relative intensity of a wave with scattering vector $\mathbf{q}$ is given by
\begin{equation}
I(\mathbf{q}) = \left|\tilde{V}(\mathbf{q})\right|^2,
\end{equation}
where $\tilde{V}(\mathbf{q})$ is the Fourier transform of the crystal potential evaluated at $\mathbf{q}$ and we approximate to single-scattering events only.

The Fourier transform of the crystal potential, for an infinite crystal, can be written in terms of the structure factors, $V_g$,
\begin{equation}
\tilde{V}_{inf}(\mathbf{q}) = (2\pi)^3 \sum_g V_g \, \delta(\mathbf{q} - \mathbf{g}),
\end{equation}
where the sum takes the scattering contribution from all the reciprocal lattice points in to account, and the scattering condition is implemented with the Dirac delta.
The crystal basis affects the calculation of the structure factors for each reciprocal lattice point.
For a particular reciprocal lattice point, the structure factor is calculated by taking the position $\mathbf{x_j}$ and scattering factors $\tilde{V}_j$ for each atom, $j$, in the crystal basis:
\begin{equation}
V_g = \frac{1}{V_{cell}}\sum\tilde{V}_j(\mathbf{g})e^{-i\mathbf{g}\cdot\mathbf{x_j}}.
\end{equation}
$V_{cell}$ is the volume of the unit cell. The Fourier transform of an isolated atomic potential gives the scattering factors, $\tilde{V}_j(\mathbf{k})$ which are not the same as the Fourier transform of the whole crystal potential, $\tilde{V}(\mathbf{k})$.
$\tilde{V}_j(\mathbf{g})$ represents the probability that the atom $j$ will scatter an electron in to a direction corresponding to $\mathbf{g}$.
Scattering factors for most elements for a range of scattering angles and electron energies have been tabulated~\cite{peng_electron_1999}.
The numerical values for scattering factors are different for electrons and X-rays and are more commonly referred to as \emph{atomic form factors} in X-ray diffraction.

Due to the relatively low electron energy and bunch count used with the \gls{caes} it was necessary to use fairly thin samples to avoid overly attenuating the beam.
The use of thin samples causes a significant deviation from the infinite crystal assumption presented above.
For a finite crystal the potential can be calculated by incorporating the \emph{shape function}, $S(\mathbf{x})$, into the calculation;
\begin{equation}
V(\mathbf{x}) = V_{inf}(\mathbf{x})S(\mathbf{x})
\end{equation}
where
\begin{equation}
S(\mathbf{x}) = \left\{\begin{array}{l l}
1, & \text{for $\mathbf{x}$ inside the crystal} \\
0, & \text{otherwise}
\end{array}
\right.
\end{equation}

The Fourier transform of this potential, with the delta functions softened into sinc functions, is
\begin{equation}\label{equation:foil_ft_potential}
\tilde{V}(\mathbf{q}) = \sum_g V_g \: t_x  t_y  t_z \: \text{sinc}{\left( \frac{(q_x-g_x)t_x}{2} \right)} \,\, \text{sinc}{\left( \frac{(q_y-g_y)t_y}{2} \right)} \,\, \text{sinc}{\left( \frac{(q_z-g_z)t_z}{2} \right)}.
\end{equation}
Here, $t_x$, $t_y$ and $t_z$ are the sizes of the illuminated portions of the crystal.
As we use crystal foils in the experiments presented here , the sinc terms end up limiting towards delta functions in the two large dimensions, $x$ and $y$.
Equation~\ref{equation:foil_ft_potential} indicates that the diffraction condition does not need to be exactly met in order to diffract electrons in a particular direction.
The intensity of the diffracted spot will be reduced the further from meeting the diffraction condition the situation is.

\subsection{Diffraction Geometry}

A typical transmission electron diffraction apparatus uses a collimated beam of electrons, directed through the sample and then observes the angle to which the electrons diffract.
The use of a collimated beam simplifies the treatment of the reciprocal space as any diffracted electrons interacting with a specific reciprocal lattice point will be scattered in the same direction.
This results in a series of beamlets which correspond to the reflections where each beamlet is also collimated and of the same size an the incident beam.
In order to resolve the beamlets, they can either be propagated to the far field or passed through a lens in order to place the detector in the focal plane.

Propagating the beam to the far field requires satisfying the Fraunhofer condition,
\begin{equation}
W^2 \ll \Delta z\,\lambda,
\end{equation}
where $W$ is the transverse size of the initial beam, $\Delta z$ is the propagation distance and $\lambda$ is the electron wavelength.
The Fraunhofer condition requires either the beam size to be very small or the propagation distance to be very large.
The more practical method is to use a lens to artificially propagate the beam.
Lenses are the usual method used in \glspl{tem} and the lenses are often combined with other sophisticated beam optics allowing for diffraction and imaging of a variety of samples and geometries.
The downside is the obvious complexity and cost associated with sophisticated beam optics.

\Glspl{tem} consist of a relatively simple electron source combined with complex optics and in contract our \gls{caes} consists of a complex electron source with relatively primitive beam optics.
For the measurements described in this chapter we only use a simple condenser lens between the source and sample to focus the beam on to the detector (the quadrupole lens discussed in Section~\ref{section:quadrupole} was added after these measurements were taken).
The beam was focused onto the detector in order to increase the intensity of the Bragg spots to inprove the \gls{snr}.
Due to the non-collimated beam there is a spread of incident angles at the crystalline samples that results in the reflected beamlets possessing the same convergence angle as the incident beam.
A schematic of the experimental setup is shown in Figure~\ref{figure:diffraction_geometry}.

\begin{figure}
    \center
    \includegraphics{part2/Figs/DiffractionGeometry.pdf}
    \caption[A schematic of the apparatus used for diffraction experiments.]{A schematic of the apparatus used in the diffraction experiments. The blue area indicates the path of the electrons.}
    \label{figure:diffraction_geometry}
\end{figure}

\section{Experimental Setup}

For the results presented in this chapter the apparatus described in Chapter~\ref{chapter:setup} was used to produce pulsed bunches of electrons.
The energy of the beam was close to the maximum the accelerator is able to produce, with the electrons given \unit[11.7]{keV}.

The majority of the data presented here was generated using electron bunches produced with ionisation pathways designed to maximise beam current.
The exception was the ultrafast diffraction measurements which used the ionisation pathways that produced ultrafast electron bunches~\cite{speirs_single-shot_2015,speirs_identification_2017,speirs_electron_2017}.

These measurement did not take advantage of the beam shaping potential of the source instead the red excitation laser was given enough optical power to saturate the atom cloud, thus producing a higher beam current than is possible with shaping.
The excitation laser beam profile was Gaussian in beamshape with a \gls{fwhm} of \unit[80]{$\muup$m} at the focus however, due to the laser intensity saturating the atom cloud, the bunch takes on the shape of the atomic cloud which tends to be Gaussian.
The electron bunches at the source have been determined to have a Gaussian shape with a \gls{fwhm} of \unit[1.4]{mm} with a divergence of $\sigma_{\theta_x}$=\,\unit[0.3]{$\muup$rad} and thus a source emittance of $\epsilon_x$=\,\unit[50]{nm\,rad}~\cite{mcculloch_high-coherence_2013}.

The number of electrons per pulse when producing ns-duration bunches with this setup was measured with a Faraday cup to be $5\times10^5$ which corresponds to a bunch charge of \unit[80]{fC}.

The solenoid lens located just after the \gls{mot}, well before the samples, was used to focus the electron beam onto the detector with as small a convergence angle as practical.
These measurement were taken before the investigations into beam astigmatism discussed in Section~\ref{section:quadrupole} so there is some asymmetry apparent in the data.

\subsection{Sample Bias}\label{section:sample_bias}

As is shown in Section~\ref{section:aluminium_diffraction}, the maximum electron energy that the accelerator electrodes are able to provide is not sufficient to observe diffraction with some of the test samples.
If higher voltages were applied to the electrodes then they would undergo electrical breakdown.
In order to provide a greater range of available particle energies a high voltage feedthrough was attached to the aluminium sample paddle so that incoming electrons would undergo a change in energy, dependant on the polarity and strength of the voltage bias.
The sample voltage bias could be up to \unit[7]{kV} before the high voltage cable would begin to short allowing for the beam energy to be increased by \unit[7]{keV}.

\section{Results}

Presented in this section are a number of results demonstrating the capabilities of the \gls{caes} with crystalline samples.
This work presents the capstone to the diffraction studies conducted with this iteration of the \gls{caes} demonstrating diffraction from a number of samples and single-shot ultrafast diffraction from gold~\cite{speirs_single-shot_2015}.

\subsection{Transmission Diffraction from Gold}

The most successful diffraction was observed with a thin foil sample of single crystal gold.
The sample was a standard \unit[3]{mm} \gls{tem} sample of \unit[11]{nm} thick monocrystalline gold on a carbon grid.
Example diffraction patterns from the gold sample are shown in Figure~\ref{figure:au_diffraction} which shows 100-shot registered-averages and single shot diffraction patterns generated with high-current ns-duration bunches and 1000-shot registered-averaged diffraction using relatively low-current ultrafast bunches.

\begin{figure}
    \center
    \input{part2/Figs/gold_diffractions.pgf}
    \caption[Diffraction patterns from gold.]{Log-scaled false-colour diffraction patterns from monocrystalline gold foil. (a) is a 100-shot average diffraction pattern generated with ns duration electron bunches. (b) is a single-shot from the set that forms (a). (c) is the radial average of (a). (d) is a 1000-shot averaged diffraction pattern generated with ultrafast electron bunches. The red lines indicate the lattice spaces for gold. The colour scale for each image is individually scaled to optimise visibility.}
    \label{figure:au_diffraction}
\end{figure}

\subsubsection{Ultrafast Diffraction from Gold}

Significant increases in beam current will permit single-shot diffraction and future iterations of \glspl{caes} should be able to provide ultrafast bunches with higher beam charge.

The ultrafast bunches were produced using two-colour multiphoton excitation, see Section\ref{section:two_stage_ionisation}, which was able to produce a few hundred electrons per shot.
Due to the lower current of the of the ultrafast bunches the Bragg spots are only visible with multi-shot averages.
A logarithmically-scaled 1000-shot average of ultrafast diffraction from gold is shown in Figure~\ref{figure:au_diffraction}(d).
Despite the low signal there was sufficient intensity in the central spot to enable the individual shots to be registered using the technique described in Section~\ref{section:registration}.
Visible about the central spot is a halo generated from poorly focused electrons from single colour multiphoton excitation.

The electron bunches used to produce this data were not themselves verified to be ultrafast via streaking but equivalent bunches were verified, as shown in Reference~\cite{speirs_identification_2017}, and it is reasonable to assume that these bunches also have durations of 10s of ps.

One of the aims of the \gls{caes} is to produce ultrafast electron bunches so this demonstration of ultrafast diffraction is an important milestone however significant improvements to ultrafast beam current are required before \glspl{caes} can be useful in producing usable single-shot ultrafast diffraction patterns particularly when compared to the current capabilities of photocathode sources.

\subsection{Aluminium}\label{section:aluminium_diffraction}

Another sample available to test the performance of the \gls{caes} was a polycrystalline evaporated aluminium foil with a thickness of \unit[31]{nm}\footnote{Diffraction Standard Evaporated Aluminium, Product No. 619, Ted Pella. Inc.}.
Normally the \gls{caes} was limited to a maximum electron energy of approximately \unit[11.7]{keV} as electrical breakdown at the electrodes would occur if higher acceleration voltages were applied, and this beam energy was not high enough to produce a visible diffraction pattern due to multiple scattering of the electrons, as can be seen in the left image in Figure~\ref{figure:al_diffraction}.

\begin{figure}
    \center
    \input{part2/Figs/al_diffraction.pgf}
    \caption[Diffraction patterns from aluminium.]{Log-scaled false-colour diffraction pattern from polycrystalline aluminium with an initial electron beam energy of \unit[11.7]{keV} and a voltage bias of \unit[8.5]{kV}. The expected diffraction rings for aluminium are show as red lines.}
    \label{figure:al_diffraction}
\end{figure}

The use of the sample bias voltage allowed for higher energy electrons which reduced the incidence of multiple scattering such that the visibility of the aluminium diffraction rings improves.
This is shown in Figure~\ref{figure:al_diffraction} where, as the sample bias is increased the visibility and separation of the rings improves.
It was not possible to increase the bias voltage beyond \unit[8.5]{kV} as electrical breakdown occurs with higher voltages.
The fields generated by the sample bias also cause some displacement and distortion in the electron beam as can be see by the shifted beam centre and slight ellipticity of the high-bias image.

In Figure~\ref{figure:al_diffraction_rings} the high-energy aluminium data has been shown with the expected locations of the diffraction rings overlaid, the lower-order rings are close to the expected locations but the higher-order rings do not line up well.
This is due to the non-linear distortion to the post-sample electron trajectories due to the strong field from sample bias voltage.

\begin{figure}
    \center
    \input{part2/Figs/al_diffraction_bias_rings.pgf}
    \caption[Diffraction pattern from aluminium demonstrating the distortion from the voltage bias.]{Log-scaled false-colour diffraction pattern from polycrystalline aluminium with an initial electron beam energy of \unit[11.7]{keV} and a voltage bias of \unit[8.5]{kV}. The red lines indicate the expected locations of the aluminium diffraction rings. Due to the non-linear distortion from the sample voltage bias the rings do not match the expected locations. The ellipticity apparent in Figure~\ref{figure:al_diffraction} has been corrected in this image.}
    \label{figure:al_diffraction_rings}
\end{figure}

If a thinner aluminium sample was used or if the beam energy could be increased further then the fewer multiple scattering events would occur and the signal-to-noise would be improved.

\section{Conclusion}

The \gls{caes} has been used to demonstrate single-shot diffraction and ultrafast diffraction from crystalline gold which are important steps along the road towards the many potential applications of a \gls{caes}.
Demonstrating single-shot diffraction is important due to a number of applications requiring high bunch charge which is demonstrated with single-shot diffraction.
Some applications also require ultrafast bunches and the diffraction results produced using such bunches are another demonstration.