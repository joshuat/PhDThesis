\chapter{Ultrafast Electron Diffractive Imaging}\label{chapter:diffraction}

One of the central motivations for \gls{caeis} is their potential use as an electron source for use with ultrafast electron diffractive imaging~\cite{speirs_single-shot_2015,van_der_geer_ultracold_2009}.
If care is taken with the ionization pathways the \glspl{caes} are able to produce ultrafast bunches of cold electrons~\cite{speirs_single-shot_2015,speirs_identification_2017,speirs_electron_2017} and with improvements to the bunch current the next generation of these sources will have the potential to be able to realise single-shot ultrafast diffractive imaging of small biomolecules~\cite{mcculloch_cold_2016}.

Previous results have shown that diffraction from large crystalline samples is possible using traditional crystallographic techniques~\cite{speirs_single-shot_2015} and this chapter describes extensions to the results shown in References~\cite{speirs_single-shot_2015} and \cite{speirs_electron_2017}, namely achieving \emph{single-shot} ultrafast diffractive imaging and the demonstration of diffraction from aluminium with a \gls{caes} by using a additional voltage bias applied to the sample holder to achieve the required beam energy.

\section{Crystallography}

Crystallography refers the the science of diffractive imaging from crystals and has been studied for over \unit[100]{years}, being the subject of the 1915 Nobel prize in physics~\cite{bragg_structure_1913}.
Crystallography has been an highly productive science having produced results such as the structure of DNA~\cite{franklin_structure_1953,dennis_eternal_2003}, and structural determination of biomolecules~\cite{longchamp_how_2015} {\color{red} more references}.
Crystallographic techniques have been under constant development and refinement since their inception.
The majority of crystallography to date has been performed using X-rays however relatively recent developements have utilised electrons as electron diffraction techniques are more versatile than those of X-rays~\cite{cowley_electron_1992}.

Due to the mature understanding of crystallographic techniques, crystallography is ideal for the first steps in demonstrating the capabilities of \glspl{caes}.
While the \gls{caes} is able to operate in \gls{cw} mode the performance with this apparatus has been optimised for pulse mode (see Section~\ref{section:pulse_vs_continuous}) and thus the results described in this chapter have been taken with pulse bunches of electrons.

\subsection{Theory}

Crystalline sturctures consist of repeated sub-structures, unit cells, each with identical arrangements of atoms.
A perfect infinite cystal can be described as a lattice of unit cells where a set of basis vectors, $\mathbf{\hat{a}}$, $\mathbf{\hat{b}}$ and $\mathbf{\hat{c}}$, can be used to describe translations,
\begin{equation}
\mathbf{t} = u\mathbf{\hat{a}} + v\mathbf{\hat{b}} + w\mathbf{\hat{c}},
\end{equation}
where the integer coordiantes $u$, $v$ and $w$ describe the number of unit cells along each basis vector.
A primitive unit cell may contain one or more atoms and symmetry is sometimes more apparent if the unit cell consists of multiple primitive unit cells.

When a wave interacting with the crystal lattice interacts with a specific atom in every unit cell then the reflected waves will be in phase, thus creating the maxima of the diffraction pattern.
These planes in the crystal that these atoms line up on can eb described by points in the reciprocal lattice.
The reciprocal lattice is described by the reciprocal lattice basis vectors, $\mathbf{\hat{a}^*}$, $\mathbf{\hat{b}^*}$ and $\mathbf{\hat{c}^*}$, where
\begin{align}
\mathbf{\hat{a}^*}&=\frac{2\pi\:\mathbf{\hat{b}}\times\mathbf{\hat{c}}}{\mathbf{\hat{a}}\cdot (\mathbf{\hat{b}} \times \mathbf{\hat{c}})}  &  \mathbf{\hat{b}^*}&=\frac{2\pi\:\mathbf{\hat{c}}\times\mathbf{\hat{a}}}{\mathbf{\hat{a}}\cdot (\mathbf{\hat{b}} \times \mathbf{\hat{c}})}  &  \mathbf{\hat{c}^*}&=\frac{2\pi\:\mathbf{\hat{a}}\times\mathbf{\hat{b}}}{\mathbf{\hat{a}}\cdot (\mathbf{\hat{b}} \times \mathbf{\hat{c}})}.
\end{align}
The $2\pi$ originates from the cenvention chosen for the wave-vector, $|\mathbf{k}|=2\pi/\lambda$. The reciprocal lattice vector is thus,
\begin{equation}
\mathbf{g} = h\mathbf{\hat{a}^*} + \mathbf{\hat{b}^*} + l\mathbf{\hat{c}^*},
\end{equation}
where the integers $h$, $k$ and $l$ are known as the Miller indices.

Scattering events can be described by, $\mathbf{q}$, the scattering vector, which is the difference between the initial and final wavevectors, $\mathbf{k_0}$ and $\mathbf{k}$;
\begin{equation}
\mathbf{q} = \mathbf{k} - \mathbf{k_0}.
\end{equation}
In the case of elastically scatter waves, $|\mathbf{k}| = |\mathbf{k_0}|$, constructive interference occurs only where $\mathbf{q}$ is equal to a reciprocal lattice vector, so that the scattering condition for crystals is
\begin{equation}
\mathbf{q} = \mathbf{g}.
\end{equation}
The realationship between the scattering vector and the scattering angle is
\begin{equation}\label{equation:diffraction_angle}
\left|\mathbf{q}\right| = 2\left|\mathbf{k_0}\right|\sin(\theta)
\end{equation}
where $\theta$ is the half angle between the initial and final wavevectors.
Due to the wavevector convention used the relation between real and reciprocal space distances is
\begin{equation}\label{equation:diffraction_distance}
\left|\mathbf{g}\right| = \frac{2\pi}{d_{hkl}},
\end{equation}
where $d_{hkl}$ is the distance between the set of planes described by the subscripted Miller indices.

If we combine Equations~\ref{equation:diffraction_angle} and \ref{equation:diffraction_distance} then we get the Bragg condition,
\begin{equation}
2d_{hkl}\sin\theta = n\lambda,
\end{equation}
where $n$ is the diffraction order.

The relative intensity of a wave with scattering vector $\mathbf{q}$ is given by
\begin{equation}
I(\mathbf{q}) = \left|\tilde{V}(\mathbf{q})\right|^2,
\end{equation}
where $\tilde{V}(\mathbf{q}$ is the Fourier transform of the crystal potential evaluated at $\mathbf{q}$ and we approximate to single-scattering events only.

The Fourier transform of the crystal potential, for an infinite crystal, can be written in terms of the structure factors, $V_g$,
\begin{equation}
\tilde{V}_{inf}(\mathbf{q}) = (2\pi)^3 \sum_g V_g \delta(\mathbf{q} - \mathbf{g}),
\end{equation}
where the sum takes the scattering crontribution from all the reciprocal lattice poitns in to account, and the scattering condition is implemented with the Dirac delta.
The crystal basis affects the calculation of the structure factors for each reciprocal lattice point.
For a particular reciprocal lattice point, the structure factor is calculated by taking the position $\mathbf{x_j}$ and scatterring factors $\tilde{V}_j$ for each atom, $j$, in the cyrstal basis:
\begin{equation}
V_g = \frac{1}{V_{cell}}\sum\tilde{V}_j(\mathbf{g})e^{-i\mathbf{g}\cdot\mathbf{x_j}}.
\end{equation}
$V_{cell}$ is the volume of the unit cell. The Fourier transform of an isolated atomic potential gives the scattering factors, $\tilde{V}_j(\mathbf{k})$ which are not the same as the Fourier transform of the whole crystal potential, $\tilde{V}(\mathbf{k})$.
$\tilde{V}_j(\mathbf{g})$ represents the probability that the atom $j$ will scatter an electron in to a direction corresponding to $\mathbf{g}$.
Scattering factors for most elements for a range of scattering angles and electron energies have been tabulated~\cite{peng_electron_1999}.
The numerical values for scattering factors are different for electrons and X-rays and are more commonly refered to as \emph{atomic form factors} in X-ray diffraction.

Due to the relatively low electron energy and bunch count it was necessary to use fairly thin samples to avoid overly attenuating the beam.
Use of thin samples causes a significant deviation from the infinite crystal assumption presented above.
For a finite crystal the potential can be calculated by incorporating the \emph{shape function}, $S(\mathbf{x})$, into the calculation;
\begin{equation}
V(\mathbf{x}) = V_{inf}(\mathbf{x})S(\mathbf{x})
\end{equation}
where
\begin{equation}
S(\mathbf{x}) = \left\{\begin{array}{l l}
1, & \text{for $\mathbf{x}$ inside the crystal} \\
0, & \text{otherwise}
\end{array}
\right.
\end{equation}

The Fourier transform of this potention, with the delta functions softened into sinc functions, is
\begin{equation}\label{equation:foil_ft_potential}
\tilde{V}(\mathbf{q}) = \sum_g V_g \: t_x  t_y  t_z \: \text{sinc}{\left( \frac{(q_x-g_x)t_x}{2} \right)} \text{sinc}{\left( \frac{(q_y-g_y)t_y}{2} \right)} \text{sinc}{\left( \frac{(q_z-g_z)t_z}{2} \right)}.
\end{equation}
Here, $t_x$, $t_y$ and $t_z$ are the sizes of the illuminated portions of the crystal.
As we use crystal foils in the experiments presented here , the sinc terms end up limiting towards delta functions in the two large dimensions, $x$ and $y$.
Equation~\ref{equation:foil_ft_potential} indicates that the diffraction condition does not need to be exactly met in order to diffract electrons in a particular direction.
The intensity of the diffracted spot will be reduced the further from meeting the diffraction condition the situation is.

\subsection{Diffraction Geometry}

A typical transmission electron diffraction apparatus uses a collimated beam of electrons, directed through the sample and then observes the angle to which the electron diffraction, thus providing information such as the crystal lattice spacing.
The use of a collimated beam simplifies the treatment of the reciprocal space as any diffracted electrons interacting with a specific reciprocal lattice point will be scattered in the same direction.
This results in a series of beamlets which correspond to the reflections where each beamlet is also collimated and of the same size an the incident beam.
In order to resolve the beamlets, they can either be propagated to the far field or passed through a lens in order to place the detector in the focal plane.

Propagating the beam to the far field requires satisfying the Fraunhofer conditions,
\begin{equation}
W^2 \ll \Delta z\,\lambda,
\end{equation}
where $W$ is the transverse size of the initial beam, $\Delta z$ is the propagation distance and $\lambda$ is the electron wavelength.
To satisfy the Faunhofer condition requires either the beam size to be very small or the propagation distance to be very large.
The more practical method is to use a lens to artificially propagate the beam.
Lenses are the usual method used in \glspl{tem} and the lenses are often combined with other sophiticated beam optics allowing for diffcration and imaging of a variety of samples and geometries.
The downside is the obvious complexity and cost associated with sophisticated beam optics.

\Glspl{tem} consist of a relatively simple electron source combined with complex optics and in contract our \gls{caes} consists of a complex electron source with relatively primitive beam optics.
For the measurements described in this chapter we only use a simple condenser lens between the source and sample to focus the beam on to the detector (the quadrupole lens discussed in Section~\ref{section:quadrupole} was added after these measurements were taken).
Due to the long focal length used the beam has a small converging angle but still cannot be considered to be converging.
Due to the non-collimated beam there is a spread of incident angles at the crystalline samples that results in the reflected beamlets possessing the same convergence angle as the incident beam.

{\color{red}Figure showing diffraction geometry}

\section{Experimental Setup}

For the results presented in this chapter the apparatus described in Chapter~\ref{chapter:setup} was used to produce pulsed bunches of electrons.
The energy of the beam was close to the maximum the accelerator is able to produce, with the electrons given \unit[11.7]{keV}.

The majority of the data presented here was generated using electron bunches produced with ionisation pathways designed to maximise beam current.
The exception was the ultrafast diffraction measurements which used the ionisation pathways that produced ultrafast electron bunches~\cite{speirs_single-shot_2015,speirs_identification_2017,speirs_electron_2017}.

These measurement did not take advantage of the beam shaping potential of the source instead the red excitation laser was given enough optical power to saturate the atom cloud, thus producing a higher beam current than is possible with shaping.
The excitation laser beam profile was Gaussian in beamshape with a \gls{fwhm} of \unit[80]{$\muup$m} at the focus however, due to the laser intensity saturating the atom cloud, the bunch takes on the shape of the atomic cloud which tends to be Gaussian.
The electron bunches at the source have been determined to have a Gaussian shape with a \gls{fwhm} of \unit[1.4]{mm} with a divergence of $\sigma_{\theta_x}$=\,\unit[0.3]{$\muup$rad} and thus a source emittance of $\epsilon_x$=\,\unit[50]{nm\,rad}~\cite{mcculloch_high-coherence_2013}.

The number of electrons per pulse when producing ns-duration bunches with this setup was measured with a Faraday cup to be $5\times10^5$ which corresponds to a bunch charge of \unit[80]{fC}.

The solenoid lens located just after the \gls{mot}, well before the samples, was used to focus the electron beam onto the detector with as small a convergence angle as practical.
These measurement were taken before the investigations into beam astigmatism discussed in Section~\ref{section:quadrupole} so there is some asymmettry apparent in the data.

\subsection{Sample Bias}\label{section:sample_bias}

As is shown in Section~\ref{section:aluminium_diffraction}, the maximum electron energy that the accelerator electrodes are able to provide is not sufficient to observe diffraction with some of the test samples.
If higher voltages were applied to the electrodes then they would undergo electrical breakdown.
In order to provide a greater range of available particle energies a high voltage feedthrough was attached to the aluminium sample paddle so that incoming electrons would undergo a change in energy, dependant on the polarity and strength of the voltage bias.
The sample voltage bias could be up to \unit[7]{kV} before the high voltage cable would begin to short allowing for the beam energy to be increased by \unit[7]{keV}.

\section{Results}

Presented in this section are a number of results demonstrating the capabilities of the \gls{caes} with cyrstalline samples.
This work presents the capstone to the diffraction studies conducted with this iteration of the \gls{caes} demonstrating diffraction from a number of samples and single-shot ultrafast diffraction from gold~\cite{speirs_single-shot_2015}.

\subsection{Transmission Diffraction from Gold}

The most successful diffraction was observed with a thin foil sample of single cyrstal gold.
The sample was a standard \unit[3]{mm} \gls{tem} sample of \unit[11]{nm} thick monocrystalline gold on a {\color{red}something} grid.
Example diffractions patterns from the gold sample are shown in Figure~\ref{figure:au_diffraction} which shows 100-shot registered-averages and single shot diffraction patterns generated with high-current ns-duration bunches and 1000-shot registered-averaged diffraction using relatively low-current ultrafast bunches.

\begin{figure}
    \center
    \input{part2/Figs/gold_diffractions.pgf}
    \caption{Log-scaled false-colour diffraction patters from monocrystalline gold foil. (a) is a 100-shot average diffraction pattern generated with ns duration electron bunches. (b) is a single-shot from the set that forms (a). (c) is the radial average of (a). (d) is a 1000-shot averaged diffraction pattern generated with ultrafast electron bunches. The red lines indicate the lattice spaces for gold. The colour scale for each image is individually scaled to optimise visibility.}
    \label{figure:au_diffraction}
\end{figure}

\subsubsection{Ultrafast Diffraction from Gold}

Significant increases in beam current will permit single-shot diffraction and future iterations of \glspl{caes} should be able to provide ultrafast bunches with higher beam charge.

The ultrafast bunches were produced using two-colour multiphoton excitation, see Section\ref{section:two_stage_ionisation}, which was able to produce a few hundred electrons per shot.
Due to the lower current of the of the ultrafast bunches the Bragg spots are only visible with multi-shot averages.
A logarithmically-scaled 1000-shot average of ultrafast diffraction from gold is shown in Figure~\ref{figure:au_diffraction}(d).
Despite the low signal there was sufficient intensity in the central spot to enable the individual shots to be registered using the technique described in Section~\ref{section:registration}.
Visible about the central spot is a halo generated from poorly focused electrons from single colour multiphoton excitation.

The electron bunches used to produce this data were not themselves verified to be ultrafast via streaking but equivalent bunches were verified, as shown in Reference~\cite{speirs_identification_2017}, and it is reasonable to assume that these bunches also have durations of 10s of ps.

One of the aims of the \gls{caes} is to produce ultrafast electron bunches so this demonstration of ultrafast diffraction is an important milestone however significant improvements to ultrafast beam current are required before \glspl{caes} can be useful in producing usable single-shot ultrafast diffraction patterns particularly when compared to the current capabilities of photocathode sources.

\subsection{Aluminium}\label{section:aluminium_diffraction}

\begin{figure}
    \center
    \input{part2/Figs/al_diffraction.pgf}
    \caption{Log-scaled false-colour diffraction patterns from multicyrstalline aluminium with an initial electron beam energy of \unit[11.7]{keV} and a voltage bias applied to the sample paddled as indicated. As the total beam energy increases from \unit[11.7]{keV} to \unit[15.9]{keV}, to \unit[20.2]{keV} the visibility of the diffraction rings increases.}
    \label{figure:al_diffraction}
\end{figure}

\subsection{Graphene}

\subsection{Other Stuff}

\subsection{Why don't all our samples work?}