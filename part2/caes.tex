\chapter{Cold-Atom Electron and Ion Source}\label{chapter:setup}

The \gls{caeis} at the University of Melbourne is a source of low temperature electrons or rubidium ions with promising potential as an alternative charged particle source.
The \gls{caeis} works by carefully ionising rubidium atoms trapped in a \gls{mot} to generate a low temperature plasma which can then be electrostatically accelerated to form a bunched particle beam.
The apparatus described here has enabled numerous experiments which have provided greater understanding of certain aspects of atomic physics and the capabilities of the \gls{caeis}.
This work identifies some of the strengths and weaknesses of our \gls{caeis} and provides guidance for developing the next generation of cold atom sources.

The \gls{caeis} was initially designed and developed by then doctoral students Simon Bell and David Sheludko and is discussed in detail in References~\cite{sheludko_shaped_2010} and \cite{bell_cold_2011}.
Numerous other masters and doctoral students have worked on maintaining and improving the system and details can be found in their theses~\cite{saliba_cold_2011,mcculloch_generation_2013,taylor_rydberg_2013,tielen_development_2015,murphy_measurement_2017,speirs_electron_2017}.

The description of the \gls{caeis} in this chapter provides a context for the rest of the thesis as all research conducted was directly or indirectly related to the continued improved of the \gls{caeis}.
Section~\ref{section:apparatus} provides a description of the apparatus and some of its limitations.
A number of investigations and improvements to source stability, source current and beam optimisation are also presented in this chapter.
A comparison of the standard pulsed operation is compared to continuous operation in Section~\ref{section:pulse_vs_continuous} to explore the possibility of achieving greater time-averaged beam current.
An essential component of data processing with this apparatus is the technique used for managing multi-shot image averaging with the unstable electron trajectories, called `registration', and this is discussed in Section~\ref{section:registration}.
Without registration the \gls{snr} in most of the results described in this thesis would be worse and a number of the measurements performed would be impossible.
Section~\ref{section:quadrupole} describes the characterisation and correction of an astigmatism in the electron bunches which provides improved beam quality and \gls{snr} for the results described in later chapters.

\section{The Melbourne CAEIS}\label{section:apparatus}
The first step in generating electrons and ions at the University of Melbourne \gls{caeis} was trapping and cooling atoms in a \gls{mot} loaded from a Zeeman slower.
The optical and magnetic trapping fields were then extinguished and the cold ground-state atoms ionised using a combination of a red excitation laser and a blue ionisation laser.
The charged particles were accelerated by a static electric field produced by the accelerator electrodes, one polarity accelerating ions towards the detector and the other electrons.
The main detector for experiments was a phosphor-coupled \gls{mcp} combined with a \gls{ccd} camera.

When acting as an electron source it was essential to turn off the \gls{mot} and Zeeman slower magnetic fields before ionisation due to the significant deviation that the fields cause to the electron trajectories.
Ion trajectories are not adversely affected if the fields are left on due to the much higher mass of ions.

There were a number of light fields required for the running of the \gls{caeis}.
The \unit[780]{nm} red lasers\footnote{MOGLabs External Cavity Diode Lasers with MOGLabs Diode Laser Controllers} were frequency locked relative to the rubidium-85 primary cycling transition, 5$^2$S$_{1/2}$ ($F=3$) $\rightarrow$ 5$^2$P$_{3/2}$ ($F^\prime=4$), also known as the cooling transition, and the repump transition, 5$^2$S$_{1/2}$ ($F=2$) $\rightarrow$ 5$^2$P$_{3/2}$ ($F^\prime=3$).
The repump beams listed below were mixed with the cooling beams and coupled into the same optical fibres for delivery to the vacuum system.
The following beams were used:
\begin{itemize}
    \item{\emph{Zeeman Slower Beam:}} Used in conjunction with the tapered magnetic coil to slow atoms leaving the oven. This beam was locked \unit[250]{MHz} below the cycling transition.
    \item{\emph{Zeeman Slower Repump Beam:}} Used to keep atoms in the Zeeman slower from being lost to the dark $F=2$ ground state. Locked \unit[250]{MHz} below the repump transition.
    \item{\emph{\Gls{mot} Cooling Beams:}} Used to cool and trap lasers in conjunction with the \gls{mot} magnetic field. Locked \unit[10]{MHz} below the cooling transition.
    \item{\emph{\Gls{mot} Cooling Repump Beams:}} Used to keep atoms in the \gls{mot} from the dark state where they can no longer be trapped. Locked to the repump transition.
    \item{\emph{\Gls{cw} Excitation Beam:}} Used to excite atoms in the \gls{mot} in the first stage of ionisation. Locked to the cooling transition.
    \item{\emph{\Gls{cw} Excitation Repump Beam:}} Used to keep atoms out of the dark state when performing ionisation. Locked to the repump transition.
    \item{\emph{Femtosecond Excitation Beam:}} Generated by a mode-locked Ti:sapphire amplified pulse laser\footnote{Spectra-Physics Spitfire Pro} with \unit[780-830]{nm} wavelength and a minimum pulse duration of \unit[35]{fs}.
    \item{\emph{Pulsed Ionisation Beam:}} A tunable \unit[457-493]{nm} \unit[10]{ns}-pulse laser used to perform the second stage of ionisation\footnote{Sirah dye laser system CSTR-D-3000}.
    \item{\emph{\Gls{cw} Ionisation Beam:}} A \gls{cw} tunable \unit[480]{nm} laser used as an alternative to the blue pulse laser\footnote{Toptica TA-SHG pro}.
    \item{\emph{Imaging Beam:}} Used to image the atom cloud. Locked \unit[4]{MHz} below the cooling transition.
\end{itemize}

A previous iteration of the cooling and repump laser systems for the \gls{caeis} consisted of six separate diode lasers each independently locked to appropriate rubidium transitions.
That setup suffered in reliability as, if any of the six diodes became unlocked (a common occurrence) then identification and relocking of the offending laser was a lengthy process.
The setup was streamlined by using only two diode lasers amplified by \glspl{ta} with greater resistance to environmental perturbations making the loss of lock a less common occurrence and easier to recover from.
A simplified schematic of the cooling and repump laser setup is shown in Figure~\ref{figure:laser_setup}.

\begin{figure}
    \center
    \includegraphics{part2/Figs/laser_setup.pdf}
    \caption[Simplified schematic of the laser setup for the \gls{caeis}.]{The simplified setup of the lasers locked to the rubidium-85 cycling (a) and repump (b) transitions.
    The \glspl{ecdl} are locked with saturated absorption spectroscopy, amplified with tapered amplifiers and frequency-offset using \glspl{aom}.
    $\Delta$s refer to the frequency relative to the cycling or repump transitions.}
    \label{figure:laser_setup}
\end{figure}

\subsection{Rubidium Oven}
The source begins with an effusive rubidium oven with a long heated collimation tube.
Typically effusive ovens are wasteful with large numbers of atoms lost to large solid angles.
This apparatus makes use of a long heated collimation tube to collect and re-emit atoms that were initially emitted at high angles.
These atoms are re-emitted back to the reservoir or into the collimated atom beam leaving the collimation tube.
The rubidium reservoir was typically heated to \unit[80]{$^\circ$C} and the collimation tube to \unit[120]{$^\circ$C}.
Detail on the design, operation, and performance of the oven can be found in References~\cite{bell_slow_2010} and \cite{bell_cold_2011}.

\begin{figure}
    \center
    \includegraphics[width=145mm]{part2/Figs/ZeemanOven.pdf}
    \caption[A schematic of the rubidium atom source.]{A schematic of the rubidium atom source. Atomic vapour from the oven is directed into the Zeeman slower where a laser detuned from the atomic resonance (shown in red), in combination with a tapered magnetic coil (blue and green), with a magnetic field as shown, slows the thermal atoms.}
    \label{figure:zeemanoven}
\end{figure}

\subsection{Zeeman Slower}
A Zeeman slower using a solenoid with tapered winding pitch is used to slow the atoms so that they can be captured by the \gls{mot}~\cite{bell_slow_2010}.
Zeeman slowers operate by using a laser red-detuned from resonance to slow the atoms down but as the atoms slow the conditions for resonance change due to the changing Doppler shift thus preventing further slowing of the atoms.
The solution to this quandary used here was a tapered magnetic coil that applied a magnetic field to shift the atomic resonance such that a particular velocity class of atoms remained resonant with the light field, and thus was slowed, along the length of the Zeeman slower.
Atoms leaving the Zeeman slower typically had velocities around \unit[35]{m/s}, well within the capture velocity of the \gls{mot}.
A schematic of the Zeeman slower along with the magnetic field produced by the tapered coil is shown in Figure~\ref{figure:zeemanoven}.

When extracting electrons from the \gls{mot} the magnetic coil must be turned off to prevent disruptions to the electron trajectory.

\subsection{Magneto-Optic Trap}
\glsreset{mot}\Glspl{mot} use a combination of magnetic and light fields to trap and cool atoms to $\muup$K temperatures~\cite{metcalf_laser_1999}.
In the \gls{caeis} the \gls{mot} was formed from six counter propagating \unit[780]{nm} lasers in a retro-reflective quasi-mirror \gls{mot} configuration~\cite{hanssen_using_2006,mcculloch_generation_2013} to allow for the accelerator structure which consisted of transparent and reflective electrodes, as shown in Figure~\ref{figure:mot}.
The magnetic component of the \gls{mot} was formed from two magnetic coils in an anti-Helmholtz configuration providing a zero-field region in the centre of the trap.

The \gls{mot} trapping lasers were detuned \unit[$-10$]{MHz} from the cycling transition and were mixed with on-resonant light at the repump transition to pump atoms that fell into the dark $F=2$ state.

\begin{figure}
    \center
    \includegraphics[width=145mm]{part2/Figs/MOTdiagram.pdf}
    \caption[A diagram of the magneto-optic trap.]{A diagram of the magneto-optic trap, ionisation lasers and accelerator structures.}
    \label{figure:mot}
\end{figure}

\subsection{Ionisation}\label{section:two_stage_ionisation}

The \gls{caeis} was capable of generating bunches of electron and ions with long (\unit[$\sim$10]{$\muup$s}), short (\unit[$\sim$5]{ns}), and ultrashort (\unit[$\sim$10]{ps}) bunch duration depending on the laser systems used~\cite{speirs_identification_2017,speirs_electron_2017}.
Depending on the ionisation pathway, the \gls{caeis} was able to produce cold electron bunches (\unit[$\sim$10]{K}) or hotter electron bunches (\unit[$>$10]{K}).
Generally cold electron bunches were preferable and desired bunch duration depended on the application, \gls{ued} for example requires ultrashort bunches.

Rubidium has a ground state ionisation threshold of \unit[4.18]{eV} which can be generated using one blue and one red photon.
Red light could be generated by a \gls{cw} diode laser amplified by a \gls{ta} and locked to the cycling transition or it could be generated with a mode-locked Ti:sapphire amplified pulsed laser with a wavelength range of \unit[770]{nm} to \unit[830]{nm} and a minimum pulse length of \unit[35]{fs}.
Blue light could be generated with a tunable dye pulse laser that produced \unit[460 to 490]{nm} light with a \gls{fwhm} duration of \unit[5]{nm} or with a \gls{cw} laser generated by a high-power tunable frequency-doubled diode laser.

Sequential ionisation utilised a single red photon to excite from the ground state to an intermediate excited state followed by a single blue photon to transition to a field-ionising state or to the ionisation continuum.
For sequential ionisation, the bunch duration was determined by the shortest of the duration of the laser pulse driving the transition from the exited state to the ionising state, the lifetime of the intermediate state, or by the depletion time of the intermediate state.

Multiphoton excitation occurs when the laser intensities are high enough for nonlinear optical transitions to occur which was the case when the red or blue pulse lasers were tightly focused into the atom cloud.
In multiphoton excitation two or more photons are absorbed without transitioning via a real intermediate state.
If $n$ is the number of photons absorbed for the atom to reach its final ionised state then the transition rate is proportional to the $n$th power of the optical intensity~\cite{joachain_atoms_2011}.
Due to the short lifetime of the virtual intermediate states the bunch duration is determined by the duration of the laser pulses.
Multiphoton excitation can occur with just photons of one colour or with photons of both colours.

\Gls{tcmpe} occurs when one blue and one red photon are absorbed but the intermediate state is a virtual state.
Due to the short lifetime of the intermediate state the duration of bunches produced by \gls{tcmpe} depends on duration of the shortest laser pulse.

\Gls{rempe} occurs when there is a combination of sequential excitation and multiphoton excitation.
Here a number of photons are absorbed to excite the atom to a real intermediate state followed by more photons of the same colour being absorbed to transition to the final state.
As less photons are required for each transition the overall transition rate can be much higher when compared to plain multiphoton excitation.

\begin{figure}
    \center
    \includegraphics[width=0.75\linewidth]{part2/Figs/ionisationmodes.jpg}
    \caption[Photoexcitation pathways.]{A number of photoexcitation pathways were possible in the presence of high intensity illumination by the red a blue lasers in the \gls{caes} such as sequential excitation (SE), multiphoton excitation (MPE), resonance-enhanced multiphoton excitation (REMPE), and two-colour multiphoton excitation (TCMPE). TCMPE is the only pathway that produces bunches that are cold and ultrashort. The images show the transverse momentum distributions for the detected bunches.
    This figure is adapted from Reference~\cite{speirs_electron_2017}.}
    \label{figure:ionisation_modes}
\end{figure}

The temperature of particles generated from the \gls{caes} depends primarily on the excess ionisation energy given to the atoms by the absorbed photons.
Due to the complex spatial probability distributions of electrons in high-lying states the relationship between absorbed photon energy and temperature is complex~\cite{mcculloch_high-coherence_2013} but it is generally true that with greater photon energy comes greater source temperature.
The classical ionisation threshold is lower in the presence of electric field, such as the accelerating field in the \gls{caeis}, due to the Stark-shift.
The excess energy of an ion or electron relative to the classical ionisation threshold is:
\begin{equation}\label{equation:ionisation_energy_stark}
\Delta E = -E_I + 2\sqrt{ke^3F} + \sum_{i=0}^{n}{\frac{hc}{\lambda_i}},
\end{equation}
where $E_I=4.18$\,eV is the ground state ionisation energy of rubidium-85, $k$ is the Coulomb constant, $e$ is the elementary charge, $F$ is the strength of the electric field, $h$ is the Planck constant, and $c$ is the speed of light.
The second term represents the Stark-shift of the classical ionisation threshold, and the last term is the sum of the energy of the $n$ photons involved in the ionisation, with wavelengths $\lambda_i$.
Equation~\ref{equation:ionisation_energy_stark} assumes that rubidium is hydrogen-like which is a good approximation as long as $E_I \gg 2\sqrt{ke^3F}$~\cite{gallagher_rydberg_2005}.

Sequential excitation and \gls{tcmpe} are the only ionisation processes that produced cold electrons as the atoms underwent field ionisation due to the combined photon energy being slightly less than $E_I$.
With the other methods the combined photon energy is larger than $E_I$ and the excess ionisation energy is transferred to the electrons.
The electron bunch temperature was demonstrated experimentally~\cite{speirs_identification_2017} and can be seen in Figure~\ref{figure:ionisation_modes} in the momentum distributions for various ionisation processes.

The duration of the charge particle bunches depended on a number of factors~\cite{speirs_identification_2017}.
Direct ionisation, with combined photon energy greater than $E_I$, resulted in short duration bunches with duration equal to that of the blue laser driving the transition to the ionisation continuum, \unit[5]{ns}.
Excitation to a Rydberg state, followed by field ionisation, resulted in relatively long duration bunches as the bunch duration in this case depends on the lifetime of the Rydberg state, typically 10s of microseconds.
Ionisation by \gls{tcmpe} could result in ultrashort duration bunches, \unit[10]{ps}, if the red femtosecond-duration pulse laser was used to excite the atoms to the virtual intermediate state.

\subsubsection{Beam Shaping}

The \gls{caeis} was able to shape the profile of the electron and ion bunches produced by manipulating the red and blue ionisation laser beams~\cite{mcculloch_arbitrarily_2011}.
The lasers imparted their spatial profiles onto the ionised atoms which, for cold low-emittance bunches, could be maintained to the detector.
The transverse bunch profile was determined by the red excitation laser profile combined with the density profile of the atomic cloud.
Similarly the longitudinal profile depended on the ionisation laser profile and atomic cloud density.

Control over the excitation beam profile was achieved with an \gls{slm} and an iterative feedback system~\cite{van_bijnen_patterned_2015}.
With a second \gls{slm} and control system the longitudinal profile could also be controllable which would allow for full three-dimensional control over the beam shape.
A schematic of the bunch profile system is shown in Figure~\ref{figure:beam_shaping_schematic} and an example of its performance can be seen in Figure~\ref{figure:beam_shaping}.

\begin{figure}
    \center
    \includegraphics{part2/Figs/beam_shaping_schem.pdf}
    \caption[A schematic of the apparatus used to produce arbitrarily shaped bunches.]{A schematic of the apparatus used to produce arbitrarily shaped bunches. The excitation laser pulse is shaped with an \gls{slm} to form an arbitrary beam profile at the atom cloud, imparting that profile onto the bunch produced by the \gls{caeis}. In this diagram the blue ionisation laser comes from behind the atom cloud.}
    \label{figure:beam_shaping_schematic}
\end{figure}

\begin{figure}
    \center
    \includegraphics{part2/Figs/beam_shaping.jpg}
    \caption[Beam shaping and the effects of temperature.]{An example of beam shaping and the effects of temperature on the bunch profile.
    \textbf{a}~The left most image indicates the excitation laser profile, and the other images are the transverse electron bunch profiles as excess ionisation energy is varied.
    \textbf{b}~Transverse electron bunch profiles generated by a uniform excitation laser profile as excess ionisation energy is varied.
    The white text indicates the image dimensions and the excess ionisation energy in meV, with negative values being below threshold ionisation.
    At \unit[$-1.680$]{meV} excess ionisation energy the bunch current increases as the ionisation laser couples to a Rydberg state.
    This figure was adapted from Reference~\cite{mcculloch_arbitrarily_2011}.}
    \label{figure:beam_shaping}
\end{figure}

Control over the bunch profile allows for customisation and feedback for whatever application the \gls{caeis} is being used for but is of particular interest for countering space-charge expansion.
Self-interactions between charged particles within a sufficiently dense bunch, referred to as space-charge expansion or Coulomb expansion, results in degradation in the quality of a bunch.
The loss of beam quality is usually expressed as an increase in emittance (see Chapter~\ref{chapter:brightness} for a definition of emittance).
Increases in bunch emittance also results in a decrease in coherence which has ramifications for imaging applications.
With the electron bunch charges achieved to date only the ultrashort duration electron bunches are dense enough to experience significant space-charge expansion.
Ion bunches produced by this source are usually dense enough to demonstrate space-charge.
Suppression of space-charge expansion has been demonstrated with the \gls{caeis} by using beam shaping to produce bunches with linear and reversible Coulomb expansion~\cite{luiten_how_2004,thompson_suppression_2016}.

\subsection{Accelerator}

The static accelerating electric field was generated by two electrodes which were approximately \unit[11]{cm} in diameter and \unit[4]{mm} thick.
One electrode was transmissive and \gls{ar} coated at \unit[780]{nm} and coated with indium-tin-oxide which is also transmissive to \unit[780]{nm} to 96\%.
The second electrode was reflective and composed of polished gold-coated copper.
Each of the electrodes had an aperture in the centre to allow the electron and ion bunches to pass through.

The limit to the beam energy the apparatus was able to produce, approximately \unit[12]{keV}, was determined by the maximum voltages that could be applied to the electrodes; any higher and the electrodes would begin to either arc or short.

\subsection{Beam Optics}

There were a number of systems in place for manipulating the electron and ion beams: a solenoid lens, an Einzel lens, a magnetic quadrupole lens, a one-axis deflector, and a number of permanent magnets located outside the vacuum system.
A schematic of the beamline is shown in Figure~\ref{figure:full_beam_apparatus}.
The lenses were used to focus the bunches, usually to a focus on the detector but sometimes to manipulate the size of the beam at the sample plane.
The quadrupole lens was used to counter astigmatism in the beam and is discussed in more detail in Section~\ref{section:quadrupole}.
The deflector was located after the sample stage and was used to streak bunches across the detector for the results presented in Chapter~\ref{chapter:brightness}.
The permanent magnets were used to steer electron bunches through the system, through a number of apertures and countering the deflection imposed by a number of anomalous magnetic fields present with the \gls{caeis}.

\begin{figure}
    \center
    \includegraphics{part2/Figs/FullApparatusSchematic.pdf}
    \caption[Beam optics schematic.]{A schematic of the optics along the charged particle beamline in the \gls{caeis}. The atoms are trapped in a \gls{mot} (not shown) located between two accelerator electrodes. Downstream from the accelerator is a magnetic solenoid lens, a magnetic quadrupole lens, an electrostatic Einzel lens, the sample holder, one-dimensional deflectors, and the \gls{mcp} detector mounted on translating bellows with a $z$ range of \unit[500]{mm}. The numbers at the bottom of the figure indicate the distance between elements and the horizontal axis is not to scale.}
    \label{figure:full_beam_apparatus}
\end{figure}

\subsection{Sample Management}

Experimental samples were mounted on a custom sample mount formed from an aluminium paddle that was large enough to mount eight \gls{tem} samples and block any portion of the beam not passing through the samples.
The samples were held by two commercial \gls{tem} mounts attached to the paddle that were able to fit \unit[3.05]{mm} diameter samples with approximately \unit[2]{mm} diameter of the sample visible to the bunches when the sample lid was in place.
Grazing incidence reflection diffraction samples could also be mounted at the end of the paddle as shown in Figure~\ref{figure:sample_holder}.
The sample paddle was mounted on a stage with manual control over two-axis translation transverse to the beam axis, as well as rotation about the horizontal transverse axis.
The sample paddle could also be connected to a high-voltage supply to allow for the sample to be biased to further manipulate the beam energy as described in Section~\ref{section:sample_bias}.

\begin{figure}
    \centering
    \begin{subfigure}{0.49\linewidth}
    \centering
    \includegraphics[width=\linewidth]{part2/Figs/sample_holder_alone.pdf}
    \end{subfigure}
    \begin{subfigure}{0.49\linewidth}
    \centering
    \includegraphics[width=\linewidth]{part2/Figs/sample_holder_in_vitro.jpg}
    \end{subfigure}
    \caption[Sample holder.]{The sample holder used in the \gls{caeis}. In the left photograph the sample holder with eight transmission samples and a reflection sample is shown. On the right is the sample holder in the sample chamber, with the post-sample deflector and Faraday cup retracted from the beam path. Bunches travel from right to left as shown by the blue arrow.}
    \label{figure:sample_holder}
\end{figure}

\subsection{Timing}\label{section:pulse_blaster}

Synchronisation throughout the experiment was achieved with a 24-channel digital timing card\footnote{Spincore Pulseblaster PCI mounted in external USB enclosure.}.
Low voltage TTL signals were used to trigger the numerous time-sensitive devices involved in the experiment.
The \gls{caeis} operated at \unit[10]{Hz}, the frequency of the flashlamp of the \unit[5]{ns} blue pulse laser.
The sequence began with \gls{mot} and Zeeman lasers and fields turning on to load the trap for approximately \unit[90]{ms}.
The trapping lasers and fields were extinguished \unit[5]{ms} before the excitation and ionisation lasers and \gls{ccd} camera were triggered to generate and detect the electron or ion bunch.

\subsection{Current Limitations of the Melbourne CAEIS}

There were a number of factors preventing the \gls{caeis} achieving its goal of electron diffractive imaging that was both single-shot and ultrafast, most importantly the low electron beam current and the instability of the electron trajectory.
These factors also require improvement for other \gls{caeis} goals such as \gls{fib} milling.

The University of Melbourne \gls{caes} was able to generate bunches of $5\times10^5$ electrons when generating \unit[5]{ns} duration bunches, which is of order the charge required for \gls{ued}~\cite{van_oudheusden_compression_2010} but only a few hundred electrons when generating \unit[10]{ps} duration bunches~\cite{speirs_identification_2017}.
There are a few avenues available to the \gls{caeis} to improve the bunch count such as increasing the \gls{mot} density, increasing the power of the ionisation laser, better optimisation of the ionisation pathways~\cite{mcculloch_field_2017}, and potentially running the apparatus in \gls{cw} mode.
\Gls{cw} mode has the potential to increase the number of particles per second however some applications would be difficult or impossible without discrete bunches.
An investigation of the performance of the apparatus in \gls{cw} mode is described in Section~\ref{section:pulse_vs_continuous}.

The stability of the source was also problematic, particularly for electron bunches, as a number of transient effects interfered with the path of the beams on timescales from shot-to-shot to minute-to-minute.
Effects such as eddy currents, due to the switching of the strong magnetic fields, in the steel of the vacuum system and optical tables was one of the primary suspects for the perturbations in the beam path.
Other potential sources are the electronic equipment such as power supplies and switches that were placed as far away from the beam path as practical but were still in the vicinity.
The poor stability of the source made some measurements difficult and others impossible.
Multi-shot measurements were required in a number of cases and, due to the drift of the beam, straight averages of the images from the detector resulted in an unusable blur.
Generating usable images for multi-shot measurements required `registration' of the images, set averages where the features in each individual image was aligned with the other images to prevent blurring.
Measurements without sharp features could not be well registered, as the registration algorithms have trouble precisely aligning the images.
Registration is discussed further in Section~\ref{section:registration}.

\section{Pulsed vs Continuous}\label{section:pulse_vs_continuous}
This \gls{caeis} had not previously been operated as a continuous source and with minor modifications it was adapted to act as a continuous source.
Comparing the performance of the source in its usual pulse mode against the performance as a continuous source had the potential to show pathways for improving the pulsed mode.
Continuous operation, if found advantageous, could have provided an alternative that could be used to demonstrate particular applications, such as \glsreset{cdi}\gls{cdi}, that do not require the source to be pulsed.
Continuous mode functions by using the two-stage ionisation and acceleration on the atom beam from the oven without cooling or trapping by the Zeeman slower and \gls{mot}.
It was hoped that the average beam current would increase with this mode of operation and that the beam produced would be subject to less drift and instability as the large magnetic fields were not switching.
This investigation of continuous operation also, almost serendipitously, permitted a more detailed investigation of the instabilities in the electron trajectory as it provided an opportunity to examine the temporal behaviour of the instability, something not possible when the source operates at a mere \unit[10]{Hz}.

While the entire apparatus and control system had been designed to operate in pulse mode it was fortunately relatively simple to modify the setup to operate to continuously produce an electron beam.
The lasers and magnetic field of the \gls{mot} were disabled, the excitation beam was left on, and the \gls{cw} blue laser was used instead of the usual blue pulse laser to drive ionisation.

Before switching to continuous mode the \gls{caeis} had been measured to have \unit[$0.42\times10^6$]{electrons per bunch} equating to a beam current of \unit[$4.2\times10^6$]{electrons per second}.
Initially the continuous mode was producing \unit[$0.64\times10^6$]{electrons per second} however there were a number of optimisations available to improve the current, as detailed below.

\subsection{Oven Temperature to Electron Count}
When operating in pulsed mode the \gls{mot} was given more than enough time to saturate and thus there was no benefit to producing more atoms from the oven.
In continuous mode the beam current was dependent on the density of atoms in the ionisation region which could be increased by increasing the atomic flux from the rubidium oven.

The atomic flux from the oven could be increased by running the oven at a higher temperature.
During normal operation the oven was set to a temperature of approximately \unit[80]{$^\circ$C} (rubidium has a melting point of \unit[39.30]{$^\circ$C}) however the oven was able to operate at up to \unit[200]{$^\circ$C}.
Previous measurements indicate that the atomic flux from the oven was \unit[$5\times10^9$]{cm$^{-2}$s$^{-1}$} at \unit[80]{$^\circ$C} and increased approximately linearly to \unit[$2\times10^{10}$]{cm$^{-2}$s$^{-1}$} at \unit[200]{$^\circ$C}~\cite{bell_slow_2010}.

The effects of the oven temperature on the beam current are shown in Figure~\ref{figure:oven_counts}.
There was a significant increase in the electron beam current as the oven temperature was increased.
With the oven at a high temperature the beam current was greater than that of the pulsed mode bunches.
An unfortunate side effect of running the oven at high temperatures is that the lifetime of the \unit[5]{g} rubidium ampule in the oven will be reduced.
Given the atomic flux measurements in Reference~\cite{bell_slow_2010}, running the rubidium oven at \unit[200]{$^\circ$C} will reduce the ampule lifetime by approximately a factor of four.
This data indicates that the \gls{cw} beam current could be improved with the use of transverse compression of the atom beam which would provide a similar improvement to beam current as more atoms would be present in the ionisation region~\cite{tielen_development_2015}.

\begin{figure}
    \center
    \input{part2/Figs/oven_counts.pgf}
    \caption[Beam current and rubidium oven temperature.]{The electron beam current, measured by the calibrated \gls{mcp} detector, compared to the temperature of the rubidium oven, as measured by an external sensor.
    The dashed black line indicates the approximate beam current for electrons generated with the \gls{caes} in pulsed mode.}
    \label{figure:oven_counts}
\end{figure}

\subsection{Blue Laser Power}

The second avenue available to increase the beam current is to increase the intensity of the \gls{cw} blue ionisation laser beam.
Optimisation of the laser and beamline allowed for up to \unit[280]{mW} to be delivered to the vacuum system.
By reducing the power of the blue beam incident on the atom beam and recording the beam current it was clear that the atoms were not saturated by the blue laser.
If the blue laser power was saturating or close to saturating the atom beam then the beam current would have been approaching a limit which is not apparent from the shape of the curve in Figure~\ref{figure:blue_power}.

While the true situation was more complicated, involving the atom beam cross-sectional area and the blue laser intensity at the atom beam, the data shown in Figure~\ref{figure:blue_power} indicates that a more powerful blue laser or better optimisation of the laser intensity at the atom beam would increase the available beam current.
Increasing the intensity of the blue ionisation laser would also improve the beam current when operating in pulsed mode as the available power of the blue pulse laser is poor.
As well as optimising or replacing the laser systems, another avenue for increasing the intensity in the ionisation region would be to recycle the beam as most of the power is transmitted through the atom beam or \gls{mot}.

\begin{figure}
    \center
    \input{part2/Figs/blue_power.pgf}
    \caption[Beam current and ionisation laser power.]{The electron beam current compared to the power in the \gls{cw} blue ionisation laser with a rubidium oven temperature of \unit[78.1]{$^\circ$C}.
    The continuing upward trend indicates that the atom beam is far from saturated by the blue beam.}
    \label{figure:blue_power}
    % Data and code located in 2016/Ultrafast_Electrons/2016.06.23
\end{figure}

Using the maximum laser power available with an oven temperature of \unit[200]{$^\circ$C} provides approximately a sixfold increase in beam current compared to pulse mode.

\subsection{Stability}\label{section:stability}

The instability in the electron beam path observed in pulsed mode was still obvious with \gls{cw} mode, indicating that the primary source of the instability was not the fast switching of the magnetic coils as had been previously suspected.
The next most likely culprit for noise was something involving the mains power supply which operates at \unit[50]{Hz} and thus, according to the Nyquist-Shannon sampling theorem, requires a sampling rate of at least \unit[100]{Hz} to observe.
The repetition rate of pulse mode, \unit[10]{Hz}, made it impossible to observe \unit[50]{Hz} behaviour but \gls{cw} mode with a high framerate camera, in this case \unit[240]{Hz}, allows for a much greater frequency range to be observed.
Focusing the \gls{cw} electron beam onto the detector gives high enough intensity to resolve the beam centre with only \unit[4]{ms} camera exposure.

In order to examine the temporal behaviour of the beam drift a faster camera was used to observe the \gls{mcp}\footnote{Point Grey Flea3 FL3-U3-13S2M-CS} with the electron beam focused at the detector.
To operate the camera at the desired framerate it was necessary to reduce the size of the image from the camera to a smaller field of view.
Data was collected with the \gls{caes} operating in continuous mode and in pulsed mode.

To assign accurate timestamps to each image it was necessary to use a feature of the camera that adds an accurate truncated timestamp directly to the image combined with the inaccurate timestamp on the image file created by the computer the camera was running on.
The combination of the fine and accurate timestamp from the camera (which only counted to \unit[128]{seconds} before resetting) with the coarse inaccurate timestamp on the image file allowed for long duration data sets to be accurately analysed.

To examine the temporal behaviour of the source stability the beam position coordinates were deduced from the images and then Fourier transformed.
With the source operating in continuous mode the analysis was limited by the framerate of the camera (\unit[240]{Hz}) and in pulsed mode it was limited by the repetition rate of the experiment (\unit[10]{Hz}).
Shown in Figure~\ref{figure:stability} are the recorded positions of the electron beam and the corresponding Fourier transforms for continuous and pulsed mode.
With the low sampling rate of the pulsed mode there is little information in the Fourier transform with the only feature being a peak near \unit[0]{Hz} corresponding to the slow oscillation visible in the data.
The higher sampling rate of the continuous mode data provides much more information with numerous peaks visible in the spectrum.
The continuous mode spectrum reveals a strong contribution at \unit[50]{Hz}, likely related to the mains power supply, as well at peaks at \unit[45]{Hz}, \unit[67]{Hz}, \unit[84]{Hz}, and \unit[92]{Hz} which are of unknown origin.

The instabilities present in the normal pulsed operation are still apparent in the continuous mode beam indicating that the fast switching of the magnetic-fields was not the primary source of the beam drift.
The \unit[50]{Hz} peaks in the position spectrum are indicative of some interaction with the main power supply however care had already been taken to keep power supplies and similar devices as far from the beamline as was practical.

\begin{figure}
    \begin{subfigure}{\linewidth}
    \centering
    \includegraphics{part2/Figs/cw_beam_stability.pdf}
    \caption{Continuous electron beam.}
    \label{figure:cw_stability}
    \end{subfigure}

    \begin{subfigure}{\linewidth}
    \centering
    \includegraphics{part2/Figs/pulse_beam_stability.pdf}
    \caption{Pulsed electron beam.}
    \label{figure:pulse_stability}
    \end{subfigure}
    \caption[Beam stability for continuous and pulsed operation.]{Beam position and position spectrum for $x$ (blue) and $y$ (green) directions for \gls{cw}-mode electrons (a) and pulse-mode electrons (b).
    Pulsed operation is limited to \unit[10]{Hz} and thus the spectrum is limited to \unit[5]{Hz}. The continuous beam spectrum was limited to \unit[120]{Hz} by the camera framerate of \unit[240]{Hz}.}
    \label{figure:stability}
    % CW data and code at 2016.06.29
    % Pulsed data and code at 2016.06.17
\end{figure}

\subsection{Summary}

It was hoped that continuous mode would provide a viable alternative to normal pulsed operation with this iteration of the \gls{caeis} with better beam current and stability.
An increase in the time-averaged beam current of approximately a factor of six is possible, compared to pulsed mode, by increasing the atomic flux and intensity of the blue ionisation laser.
The fast switching on and off of the \gls{mot} and Zeeman slower magnetic coils were eliminated as a primary candidate for the electron beam instabilities as the magnitude of the drift was more or less the same with pulsed and \gls{cw} mode.

The investigations in this section indicate that, with the current apparatus, continuous mode is able to provide an increase in beam current but no increase in beam stability at the cost of no longer being able to produce ultrafast bunches.
The next generation of the \gls{caeis} now under construction will operate as a continuous ion source, capitalising on the beam current achievable by directly ionising the atom beam~\cite{mcculloch_heralded_2018}.

\section{Registration}\label{section:registration}

Instability in the beam path (see Section~\ref{section:stability}) resulted in the electron beam trajectory drifting from shot-to-shot.
When multi-shot averages were required the beam drift resulted in the beam being `smeared' when averaged.
It was necessary to `register' the images to prevent this smearing and this is demonstrated in Figures~\ref{figure:registration_examples} and \ref{figure:real_registration_examples}.

\begin{figure}
    \center
    \input{part2/Figs/registration_examples.pgf}
    \caption[Contrived image registration example.]{A demonstration of the importance of the image registration technique using a contrived example of slipping. \emph{Single-Shot} is a single image from a prototype-pepperpot data set of 1000 images. \emph{Average} is the simple average of all 1000 images. \emph{Slipped} is a contrived demonstration of slipping; there is an additional set of beamlets visible at the top of the image. \emph{Registration} is a successful registration where a shot-to-shot limit to drift was enforced. All the images are independently log scaled.}
    \label{figure:registration_examples}
    % Data and code in 2016.10.27
\end{figure}

\begin{figure}
    \center
    \input{part2/Figs/streak_registration_examples.pgf}
    \caption[Realistic image registration example.]{A demonstration of the image registration technique using a real example. \emph{Single-Shot} is a single image from a streaked pepperpot data set of 1000 images. \emph{Average} is the simple average of all 1000 images. \emph{Slipped} is an attempt at registration that only looks for the maximum value of the convolution with no limit on shot-to-shot variation; there is an additional faint beamlet visible at the top of the image. \emph{Registration} is a successful registration where a shot-to-shot limit to drift was enforced. Below each image is the row sum of that image. All the images are independently log scaled.}
    \label{figure:real_registration_examples}
    % Data and code in 2016.10.27
\end{figure}

Registration consisted of convolving each image with a reference image, recording the location of the maximum value of the convolution and then using that location to align all the images.
The reference image usually consisted of either just the first image in the set or the average image of the entire set, depending on the amount of signal in a single image.
The registration process could also be performed iteratively where the reference image became the aligned output of the previous iteration.

Registration functioned very well for low noise, structured data such as diffraction patterns (see Chapter~\ref{chapter:diffraction}) or pepperpot beam masks (see Chapter~\ref{chapter:brightness}).
Low signal data could be registered as long as there was sufficient signal in a single shot for the convolution to correctly identify the features of the image.
Unstructured data or continuous data, such as large flat beam profiles, did not register well as the convolution was not able to identify common features well.

Noisier data required more care than clean data and in some cases could not be registered.
One of the registration errors that has occurred with pepperpot data is `slipping' where the convolution maxima correspond to neighbouring beamlets rather than the same beamlet and thus the images are incorrectly aligned.
This error could be evaded by applying a limit to how far the convolution maxima of an image could change from shot to shot, generally the limit should be less than the distance between beamlets.
This allowed slow drift of the beam path to be accounted for while preventing slipping.

Slipped, and therefore failed, pepperpot registrations were usually easy to identify since the number of beamlets was known and slipped errors results in extra beamlets appearing in the registered image.
While registering the pepperpots the best results were provided with around 3 iterations and limits on the shot-to-shot drift less than distance between the pepperpots beamlets.
An contrived example of a slipped registration is shown in Figure~\ref{figure:registration_examples} and a real, albeit subtle, example can be seen in Figure~\ref{figure:real_registration_examples} using data from Chapter~\ref{chapter:brightness}.

\section{Astigmatism}\label{section:quadrupole}

During the investigations already discussed in this section, astigmatism was observed in the electron beam.
The astigmatism was apparent when the strength of the electron lenses were adjusted or while translating the \gls{mcp} detector past a beam focus as the two orthogonal transverse axes did not share a focal point, as shown in Figures~\ref{figure:astigmatism_translation} and \ref{figure:quadrupole_scans_off}.

\begin{figure}
    \centering
    \input{part2/Figs/astigmatism_translation.pgf}
    \caption[Electron beam astigmatism.]{A demonstration of astigmatism in the electron beam as the detector is translated past the focal points. The $x$- (blue) and $y$-axis (green) \gls{rms} beam radii are shown on the vertical figure axis and the horizontal figure axis shows the \gls{mcp} detector position along the beam axis, $z$.
    The crosses indicate the measured beam size and the lines a fit to the Gaussian beam waist equation.
    The beam astigmatism is apparent as the two axes do not come to a focus at the same position.}
    \label{figure:astigmatism_translation}
    % Code and data at 2016.08.09
\end{figure}

A quadrupole magnetic field can be used to correct for astigmatism in a beam along a fixed axis.
A quadrupole magnetic field can be described as
\begin{align}
B_x &= K y \notag\\
B_y &= K x,
\end{align}
where the constant $K$ indicates the strength of the field, and $x$ and $y$ refer to the transverse displacement from the central axis.
The force on particles in a charged beam, such as that in the \gls{caeis}, passing through a quadrupole field is shown in Figure~\ref{figure:quadrupole_example} where there is an inwards force along one axis and an outwards force along the other, which is ideal for correcting astigmatism.

\begin{figure}
    \centering
    \begin{subfigure}{0.49\linewidth}
    \centering
    \input{part2/Figs/QuadrupoleField.pgf}
    \caption{Magnetic Field}
    \label{figure:quadrupole_example_field}
    \end{subfigure}
    \begin{subfigure}{0.49\linewidth}
    \centering
    \input{part2/Figs/QuadrupoleForce.pgf}
    \caption{Force Field}
    \label{figure:quadrupole_example_force}
    \end{subfigure}
    \caption[Quadrupole magnetic and force fields.]{The magnetic field and force on a moving electron for a quadrupole lens. (a) shows the magnetic field, and (b) shows the force field for an electron beam travelling out of the page, (b), where the arrows indicate the direction and strength of the field.
    The green circles and crosses indicated the cross section of the quadrupole solenoids with circles representing current travelling out of the page and crosses into the page.}
    \label{figure:quadrupole_example}
    % Code for figures located in Code/Electrons/Simulation/Older Simulator Code/MagneticFields.py
\end{figure}

To correct the astigmatism in the \gls{caes} a simple solenoid magnetic quadrupole lens was designed and built consisting of four solenoid magnets, orientated radially, and spaced around the beamline with alternating current directions as shown in Figures~\ref{figure:quadrupole_example} and \ref{figure:quadrupole}.
The design was constrained as it had to be external to the vacuum system with an inner diameter of \unit[70]{mm} and have a longitudinal length less than \unit[20]{mm} due to the crowded beamline.
Simulations were performed to determine the approximate number of current turns required for the solenoids forming the quadrupole lens as well as the ideal transverse solenoid length.

\begin{figure}
    \centering
    \includegraphics[width=0.5\linewidth]{part2/Figs/quadrupole.jpg}
    \caption[3D printed quadrupole lens.]{The 3D printed chassis wound with copper wire to form a quadrupole lens. The scale is apparent from \unit[70]{mm} inner diameter of the lens and the \unit[25]{mm} spacing of the holes of the optical bench the lens is resting on.}
    \label{figure:quadrupole}
\end{figure}

\subsection{Quadrupole Simulations}

A simple charged particle simulator was created with the ability to propagate charged particles through arbitrary magnetic fields which in this case were formed by a parameterised quadrupole lens.
The code for these simulations is given in Appendix~\ref{appendix:code}.
The electrons used in the simulations had a beam energy of \unit[8.5]{keV} and an initial \gls{rms} beam radius of \unit[5]{mm}, similar to electron bunches produced by the \gls{caes}.
The electrons were given normally distributed randomly determined initial transverse velocities with the $x$ velocity distribution given an \gls{rms} width of \unit[10]{km\,s$^{-1}$} and the $y$ velocity distribution given an \gls{rms} width of \unit[20]{km\,s$^{-1}$} which produced an astigmatism similar to that observed experimentally.
The electrons bunches were propagated \unit[250]{mm} to the virtual quadrupole lens, through the lens, for another \unit[250]{mm} to a focusing lens, and finally for another \unit[500]{mm} to observe the beam foci.
A number of figures of merit were available to determine the ideal design, such as the degree to which the quadrupole lens was able to correct the astigmatism, the current required for the lens to correct for the astigmatism, and the size of the beam waist.

A portion of the simulation results are shown in Figure~\ref{figure:quad_sims} and the main figures of merit used were the separation of the foci for each axis and the number of current turns required to achieve minimum foci separation for a given solenoid transverse radius.
The results indicate that negligible waist separation requires a transverse solenoid radius of at least \unit[35]{mm} and that the larger the transverse radius the lower the required current turns through the solenoids.

\begin{figure}
    \centering
    \input{part2/Figs/quad_sims.pgf}
    \caption[Quadrupole simulation results.]{Particle simulation results from propagating \unit[8.5]{keV} electrons through a quadrupole lens while varying the quadrupole parameters. The electrons had an initial \gls{rms} bunch radius of \unit[5]{mm} and were given initial velocities to replicate the astigmatism observed in the \gls{caes}. The left figure shows the minimum separation of the beams waists in the $x$ and $y$ direction as the transverse radius of the solenoids forming the quadrupole was varied. The right figure shows the current turns required to achieve the minimum waist separation as the transverse solenoid radius was varied.}
    \label{figure:quad_sims}
    % Code located at Code/Electrons/Simulation/Older Simulator Code/ElectronLens.py
\end{figure}

\subsection{Quadrupole Construction}

The selection of parameters for the construction of the quadrupole lens was informed by the simulations and a transverse radius of \unit[35]{mm} was chosen to provide small beam waist separation with a manageable number of current turns given the current supplies available.
Another consideration was the space available along the beamline: if a wider solenoid transverse width was chosen then there would be additional complexity required to mount the lens to the vacuum system in the limited space available.

The chassis for the quadrupole solenoids was modelled and 3D printed from plastic and the solenoid coils were hand wound onto the chassis, as shown in Figure~\ref{figure:quadrupole}.
Each of the solenoid coils had approximately 100 turns.

\subsection{Quadrupole Correction}

The quadrupole lens functioned as desired and was able to correct the astigmatism as demonstrated in Figure~\ref{figure:quadrupole_scans}.
The lens required a current of approximately \unit[1]{A} running through the solenoids in order to correct the astigmatism.
The lens was used during a number of measurements to improve the bunch quality; an example of this is shown in Figure~\ref{figure:astigmatic_pepperpot}. 

\begin{figure}
    \centering
    \begin{subfigure}{0.49\linewidth}
    \centering
    \input{part2/Figs/quadrupole_off.pgf}
    \caption{Quadrupole Off}
    \label{figure:quadrupole_scans_off}
    \end{subfigure}
    \begin{subfigure}{0.49\linewidth}
    \centering
    \input{part2/Figs/quadrupole_on.pgf}
    \caption{Quadrupole On}
    \label{figure:quadrupole_scans_on}
    \end{subfigure}
    \caption[Astigmatism correction.]{The size of the electron beam on the detector as the Einzel lens voltage is varied with the quadrupole lens off (a) and on (b). The blue lines indicate the horizontal, $x$, \gls{rms} beam size and the green lines the vertical, $y$, \gls{rms} beam size. Inset in each figure are linearly scaled images of the beam profiles for minimum spot size for each axis. The quadrupole is able to correct the astigmatism present in the beam.}
    \label{figure:quadrupole_scans}
    % Code and data at 2016.11.02
\end{figure}

\section{Summary}

The University of Melbourne \gls{caeis} has undergone many changes and improvements since its inception, the most recent of which have been detailed in this chapter.
The apparatus was able to produce low temperature electron and ion bunches with arbitrary transverse profiles which had sufficient coherence for the imaging of small biomolecules.

Careful manipulation of the ionisation mechanisms of \gls{caeis} allowed for the production of electron and ion bunches with duration that ranged from 10s of picoseconds to nanoseconds to 10s of microseconds.
Picosecond duration bunches have the potential to be used with bunch compression to produce femtosecond duration bunches for \gls{ued}.
The remaining obstacles to swift progress towards the production of molecular movies are the low beam current, particularly for ultrafast bunches, and the unstable electron trajectories.

A comparison of the usual pulsed \gls{caeis} operation with continuous beam production was undertaken in the hopes that beam current and electron trajectory stability could be improved.
This investigation did not result in an improvement to beam stability but did prove useful in eliminating the \gls{mot} coils as a potential cause and identifying the \unit[50]{Hz} frequency of the primary noise source.
Continuous operation was able to produce higher current beams than pulsed operation.

The registration algorithm is an essential component of the \gls{caeis} that deals with electron beam path instability by aligning images from multiple shots as the beam drifts.
This technique allows for measurement that would otherwise not be possible and is essential to the diffraction and brightness measurements that will be presented in Chapters~\ref{chapter:diffraction} and \ref{chapter:brightness}.

Beam astigmatism in the electron beam was also detected and characterised.
A magnetic quadrupole lens was designed and built to correct this astigmatism.
This quadrupole lens was used to improve the beam quality for the measurements presented in Chapter~\ref{chapter:brightness}.