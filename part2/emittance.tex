\chapter{Time-Resolved Brightness Measurement}\label{chapter:brightness}

The most comprehensive figure of merit for charged particle beams is brightness, which incorporates beam current and emittance~\cite{reiser_theory_2008}.
Emittance can be improved, along with potential imaging resolution, with the aperturing of a beam but there will be a loss of beam current which will result in imaging tasks taking longer to complete.
Brightness can be used to as a metric for both resolution and imaging time.
Brightness measurements can also serve as a powerful diagnostic of the processes involved in beam creation and manipulation~\cite{mills_brightness_1980,qiang_three-dimensional_2006,bazarov_maximum_2009}.
Brightness measurements are typically static but time-resolution has the potential to reveal information related to effects such as electron diffusion time, image-charge formation, and space-charge interactions.
This chapter presents a technique for measuring time-resolved brightness by combining pepperpot emittance measurements with beam streaking, and demonstrates the method with electrons generated from the \gls{caeis}
This work has been published as Reference~\cite{torrance_time-resolved_2018}.

The pepperpot method measures the transverse emittance of a charged particle beam using an array of apertures or slits to divide the beam into smaller beamlets that are detected after propagation~\cite{collins_extraction_1964,van_steenbergen_evaluation_1967,wang_beam_1991,brunetti_low_2010}.
The divergence, and thus the emittance, can be determined by measuring the position and size of each beamlet, giving an approximation of the transverse phase space of the beam~\cite{zhang_emittance_1996,wang_beam_1991}.
The pepperpot method has been used on both electron and ion beams, and with electron energies up to 500\,MeV~\cite{delerue_single-shot_2010}.

Time-resolved emittance measurements have been performed previously using time-gated detectors to study the feasibility and performance of laser-generated ion sources~\cite{collier_cern_1996,yoshida_simple_2001}, and with scanning slits and the time-resolved signal from a Faraday cup with the aim of minimising the emittance of an electron storage ring~\cite{walter_time_2003}.
These methods require many shots to accumulate the temporal profile, and consequently only measure the average beam behaviour and are fundamentally incapable of observing shot-to-shot variation in bunch dynamics.
An alternative method to determine the temporal emittance profile of a bunch is to apply a time-varying deflection to the beamlets formed by a one-dimensional pepperpot mask (a line of apertures) to `streak' the measurement across an imaging detector.
Streaked measurements have been used in electron diffraction studies to observe non-repeatable dynamical processes~\cite{li_note:_2010, mukojima_streak-camera_2015}, and to characterise the electron pulse at the Linac Coherent Light Source (LCLS)~\cite{ratner_time-resolved_2015}.
With a sufficiently intense source, streak measurements could be performed in a single shot, providing information on shot-to-shot behaviour to elucidate information unavailable to multiple shot averages, such as transient and stochastic effects.

There are a number of important reasons for interest in time-resolved brightness measurements with a \gls{caeis}, beacause high brightness is critical to achieving high spatial and temporal resolution imaging.
Knowledge of source brightness is of particular interest in a number of areas such as the advantage of knowing beam coherence for \gls{ued}, the ability to observe the performance of techniques to counter space-charge expansion, and the potential to provide information on the ionisation processes in a \gls{caes}.
Beam emittance is also a vital factor when considering ion beam milling and ion microscope applications as the emittance limits the resolution achievable~\cite{scipioni_helium_2008,khizroev_focused-ion-beam-based_2004}.

The \gls{caeis} is a promising candidate for \gls{ued} imaging and structure determination due to its potential for high brightness and coherence, with the prospect of enabling the measurement of atomic-level sub-picosecond structural dynamics~\cite{siwick_atomic-level_2003,putkunz_atom-scale_2012,sparkes_high-coherence_2014}.
\gls{ued} is often performed with photocathode electron sources which have sufficient current and bunch duration for \gls{ued} with crystalline samples but has limited coherence~\cite{van_oudheusden_electron_2007,tokita_single-shot_2009,sciaini_femtosecond_2011}.
A \gls{caes} has the necessary coherence for \gls{ued} of nanocrystals and large molecules but not yet sufficient current~\cite{saliba_spatial_2012,mcculloch_high-coherence_2013}.
In the context of (ultrafast) diffractive imaging, time-resolved knowledge of the source coherence can be incorporated into the image reconstruction to improve the process and, as the coherence can be calculated from the emittance, the technique presented here could prove to be useful for achieving \gls{ued} of nanocrystals and even non-crystalline targets~\cite{flewett_extracting_2009,abbey_lensless_2011}.

Electron bunches from the \gls{caes} can be produced with durations over a range of timescales, from femtoseconds to microseconds.
With the use of femtosecond duration pulse lasers, a \gls{caes} can produce ultrashort electron bunches, which are dense enough to experience space-charge expansion and the related loss of beam quality~\cite{luiten_how_2004,van_oudheusden_compression_2010,thompson_suppression_2016}.
One of the obstacles to single-shot, \gls{ued} is degradation of beam quality due to space-charge expansion and streaked pepperpot measurements could be used to observe the performance of techniques designed to counter space-charge expansion~\cite{thompson_suppression_2016}.

The production of electrons from photoionised cold atoms is a complex process, and the temporal profile of pulses from these sources has been characterised under a variety of ionisation conditions~\cite{speirs_identification_2017}.
The same complex ionisation processes that result in variable pulse duration are also likely to affect the transverse velocity of the emitted electrons, and thus the emittance, as a function of time.
The streaked pepperpot method presented allows the transverse velocity spread of the liberated electrons to be measured as a function of time, which can illuminate the underlying atomic ionisation processes and provide a diagnostic which could allow optimisation of electron bunch brightness in the future.

This chapter presents a simple method of measuring time-resolved emittance that is applicable to a wide range of charged particle sources and which could be used for single-shot measurement of sources with high currents.
The streaked-pepperpot technique was developed to observe time-varying effects during the photoionisation and extraction of electrons from the \gls{caes}.
The brightness of a \gls{caeis} is important to potential applications and the time-resolution provided by the technique described in this chapter will be a useful tool to examine the behaviour of the source and hopefully provide avenues for improvement.

This chapter examines time-resolved emittance measurements through the streaking of pepperpots, including the theory involved, various technical considerations, example measurements and implementation of this technique with the \gls{caeis} at the University of Melbourne.

\section{Brightness and Emittance}

A given ensemble of particles can be described by its density in six-dimensional phase space, $(x, p_x, y, p_x, z, p_z)$ where $(x, y, z)$ are the positions and $(p_x, p_y, p_z)$ are the momenta of each particle.
The extent of the beam in phase space is called the \emph{emittance}, $\epsilon$, of the beam.
Each Cartesian direction is examined separately, $(\epsilon_x, x, p_x)$, $(\epsilon_y, y, p_y)$ and $(\epsilon_z, z, p_z)$ where $z$ is the optic axis of the beam.

Typically the gradients of trajectories in $x$-$z$ and $y$-$z$ are measured rather than the momenta.
These gradients are referred to as the divergence and are defined as
\begin{equation}\label{equation:divergence}
x^\prime \equiv \frac{dx}{dz} = \frac{v_x}{v_z}.
\end{equation}
The space of $(x, x^\prime)$ is referred to as trace-space.
An example of the trace-space occupied by a beam is shown in Figure~\ref{figure:emittance_example}.
The \emph{emittance} can be defined as
\begin{equation}
\epsilon_x \equiv \frac{A^x}{\pi}
\end{equation}
where $A^x$ is the area occupied by the beam in trace space.

\begin{figure}
\center
\includegraphics{part2/Figs/EmittanceExample.pdf}
\caption[Trace-space for expanding, collimated and shrinking beam.]{An example of the trace-space occupied by an expanding, collimated and shrinking beam. The dotted line indicates the area occupied by the beam, the emittance.}
\label{figure:emittance_example}
\end{figure}

The \emph{\gls{rms} emittance} is a more practical measure and is defined as
\begin{equation}\label{emittance}
\bar{\epsilon}_x \equiv \sqrt{\langle x^2\rangle \langle x^{\prime 2}\rangle - \langle x x^\prime\rangle^2} \simeq \frac{\epsilon_x}{4}.
\end{equation}

The emittance of a beam represents the `focusability' of the beam.
A low emittance beam can be focused to a smaller waist than a high emittance beam, in fact a beam with zero emittance could be focused to a point whereas any beam with non-zero emittance has a finite spot size, this is shown in Figure~\ref{figure:focusability}.
This makes emittance an important quantity to consider in almost all beam applications but is particularly important to charged beams due to complications produced by space-charge repulsion.

\begin{figure}
\center
\includegraphics{part2/Figs/EmittanceFocasability.pdf}
\caption[Comparison of zero and non-zero emittance.]{On the left is a particle beam with zero emittance, and thus can be focused to a beam waist of zero width. On the right is a beam with non-zero emittance and thus a non-zero beam waist. Below each figure are plots of the phase space at difference points in the beam where the dashed line is indicative of the phase-space area or emittance.}
\label{figure:focusability}
\end{figure}

The emittance of a beam is not the only factor that determines the quality of the beam.
Emittance could be made arbitrarily small through the use of collimating slits however the reduced particle could would reduce the usefulness of that beam for most applications.
A more comprehensive figure of merit is the number of particles with a given emittance, known as \emph{brightness}~\cite{reiser_theory_2008};
\begin{equation}
B = \frac{I}{8\pi^2\bar{\epsilon}_x\bar{\epsilon}_y},
\end{equation}
where $I$ is the current of the beam and $\bar{\epsilon}_{x,y}$ is the \gls{rms} emittance as described above.
Compared to emittance, which characterises the ultimate spatial resolution that can be obtained, brightness provides a better metric of beam quailty because it incorporates the beam current which is important in determining the temporal resolution.

To compare the emittance and brightness of particle beams with different beam energy it is useful to define the \emph{normalised} emittance and brightness
\begin{align}
\bar{\epsilon}_{n,x} &= \beta\bar{\epsilon}_x,\\
B_n &= \frac{I}{8\pi^2\bar{\epsilon}_{n,x}\bar{\epsilon}_{n,y}}
\end{align}
where $\beta=v/c\approx v_z/c$ and $c$ is the speed of light.
Normalised brightness and emittance are invariant for a particular beam under ideal conditions.

\subsection{Emittance with a CAEIS}
\label{section:excess_energy_emittance}

The normalised \gls{rms} emittance for a thermal source (such as the \gls{caes}), is given by~\cite{mcculloch_high-coherence_2013}
\begin{equation}\label{equation:excess_energy_emittance}
\bar{\epsilon}_{n,x} = \sigma_x \sqrt{\frac{k_B T}{m c^2}}
\end{equation}
where $\sigma_x$ is the \gls{rms} beam radius, $k_B$ is Boltzmann's constant, $T$ is the temperature of the source, and $m$ is the particle mass.
Equation~\ref{equation:excess_energy_emittance} highlights one of the advantages of a \gls{caeis}: the low source temperature allows for low emittance bunches compared to common thermionic sources.

The temperature of the \gls{caeis} source can be calculated from the wavelength of the ionisation lasers, $\lambda_{red}$ and $\lambda_{blue}$,
\begin{align}
 E_{red} &= \frac{hc}{\lambda_{red}} \\
 E_{blue}&= \frac{hc}{\lambda_{blue}},
\end{align}
where $h$ is Planck's constant.
We can define the total ionisation energy to be
\begin{align}
E_{total} = E_{red} + E_{blue}.
\end{align}
The ionisation energy for Rubidium 85, $E_I$ is \unit[4.18]{eV}~\cite{steck_rubidium_2008} so we can determine the excess energy of ionisation
\begin{equation}
E_{excess} = E_{total} - E_I
\end{equation}

The excess energy can be related to the temperatures of the ionised particles via
\begin{equation}\label{equation:excess_energy_temperature}
T = \frac{E_{excess}}{k_B},
\end{equation}
if some of the details, such as disorder induced heating, are ignored.
Combining Equations \ref{equation:excess_energy_emittance} and \ref{equation:excess_energy_temperature} allows for the calculation of the expected emittance of bunches generated from the \gls{caeis} for above-threshold ionisation.
The emittance of bunches generated from below-threshold pathways, such as Rydberg-excitation with field-ionisation, cannot be calculated using Equation~\ref{equation:excess_energy_emittance}, see Reference~\cite{mcculloch_field_2017} for greater detail.

\section{Measurement}

Directly calculating the emittance of an ensemble with Equation~\ref{emittance} requires full knowledge of the position and momenta of the particles which is difficult because beam monitors tend to only measure the transverse positions of particles.
There are a number of methods to measure the emittance of a particle beam, namely pepperpots, the multiple profile method and the examination of beam profile as the strength of a well characterised lens is varied.
In the Melbourne \gls{caeis} the lens method is not practical as the lenses in the system are not well characterised and multi-profile measurements are tedious due to the required manual z-translation of the detector and bellows.
The pepperpot method however is achievable with this system although the details of the geometry are not ideal with this iteration of a \gls{caeis}.

\subsection{Pepperpots}

The pepperpot method uses a beam mask, consisting of an array of apertures, to separate the beam into a number of `beamlets' which are then propagated and imaged with a spatially resolved detector.
By examining the size of the beamlets the divergence of the beam can be estimated and thus the emittance of the beam can be calculated.
Ideally the extent of the array should be larger than the size of the beam and the holes as small as is practical while maintaining sufficient flux and ensuring the spots on the detector do not overlap.
The name refers to the similarity of the simplest beam mask to the perforated lid of a container for pepper.

A useful derivation of this technique is presented in Reference~\cite{zhang_emittance_1996} with the one dimensional result:

\begin{dmath}\label{equation:pepperpot}
\epsilon_x^2 = \left\langle x^2\right\rangle \left\langle x^{\prime2}\right\rangle - \left\langle xx^\prime\right\rangle^2\allowbreak
\approx \frac{1}{N^2} \left\{\left[\sum_{j=1}^p{n_j\left(x_{sj}-\bar{x}\right)^2}\right] \left[ \sum_{j=1}^p{\left[n_j\sigma_{x_j^\prime}^2 + n_j\left(\bar{x_j^\prime}-\bar{x^\prime}\right)^2\right]}\right] - \left[ \sum_{j=1}^p{n_jx_{sj}\bar{x_j^\prime}-N\bar{x}\bar{x^\prime}}\right]^2\right\}
\end{dmath}
where;
\begin{itemize}
    \item $N$ is the total number of particles after the beam mask,
    \item $p$ is the total number of holes in the $x$ direction,
    \item $n_j$ is the number of particles passing through the $j$-th hole and hitting the detector,
    \item $x_{sj}$ is position of the $j$-th hole,
    \item $\bar{x}$ is the mean position of the holes,
    \item $\sigma_{x_j^\prime}$ is the \gls{rms} divergence of the $j$-th beamlet,
    \item $\bar{x_j^\prime}$ is the mean divergence of the $j$-th beamlet, and
    \item $\bar{x^\prime}$ is the mean divergence of all beamlets.
\end{itemize}

An example pepperpot mask and detected beamlets are shown in Figure~\ref{figure:pepperpot_example}.
For two-dimensional pepperpots this equation can be implemented by appropriately rotating the detected beamlets and then performing row and column sums of the pixels followed by application of Equation~\ref{equation:pepperpot} for $x$ and $y$.
For one-dimensional streaked pepperpot measurements the image should be rotated such that the streaks are horizontal, or vertical, and then each column, or row, can be used to determine the emittance at that point in the streak.

\begin{figure}
    \centering
    \begin{subfigure}{0.49\linewidth}
    \centering
    \includegraphics[width=\linewidth]{part2/Figs/example_pepperpot_mask.jpg}
    \caption{}
    \label{figure:pepperpot_mask}
    \end{subfigure}
    \begin{subfigure}{0.49\linewidth}
    \centering
    \input{part2/Figs/example_pepperpot_detector_linear.pgf}
    % 486.971 pepperpot from 2017.06.06, plot_fiting.py
    \caption{}
    \label{figure:pepperpot_image}
    \end{subfigure}
    
    \begin{subfigure}{0.49\linewidth}
    \centering
    \includegraphics[width=\linewidth]{part2/Figs/example_pepperpot_1d.jpg}
    \caption{}
    \label{figure:1d_pepperpot}
    \end{subfigure}
    \begin{subfigure}{0.49\linewidth}
    \centering
    \input{part2/Figs/example_streaked_pepperpot.pgf}
    % Code and data in 2017.07.25, plot2error.py
    \caption{}
    \label{figure:streaked_1d_pepperpot}
    \end{subfigure}
    % Manual labels.....
    \caption[One- and two-dimensional pepperpot masks.]{(a) a pepperpot mask cut into a thin \unit[3]{mm}-diameter copper disk and, (b), the corresponding set of beamlets on the detector. (c) a one-dimensional pepperpot mask and the corresponding streaked set of beamlets on the detector, (d). The beam images are log scaled and the normalised color scale is indicated in (d).}
    \label{figure:pepperpot_example}
\end{figure}

\subsubsection{Temporal Resolution with Streaking}
A one-dimensional pepperpot consisting of a line of apertures provides a good basis for streak measurements.
In this case streaking is performed with a time varying electric field which deflects the charged particles across the detector.
For a pulsed charged particle source, such as the \gls{caeis}, the streak can be performed over the duration of the bunch or over a portion of the bunch if higher temporal resolution is required.
There are some considerations for how fast an electric field can be swept, which will not be examined in detail here.
Extremely short bunches will require more sophisticated streaking systems, such as an \gls{rf} cavity or photoactivated switching which are able to provide temporal resolution as low as \unit[100]{fs}~\cite{li_note:_2010,kassier_compact_2010,van_rens_theory_2018}.
An example of a streaked pepperpot measurement is shown in Figure~\ref{figure:streaked_1d_pepperpot}.

\section{Experimental Setup}

A number of modifications were made to the \gls{caeis} for the streaked emittance measurements and there were a number of restrictions on various parameters due to the precise setup of the apparatus.
The \gls{caeis} was operated in electron mode for these measurements due to the available magnetic optics and the larger emittance expected from electrons compared to ions.
The source temperature, and hence emittance, is higher for electrons, approximately \unit[10]{K} for electrons and \unit[100]{$\muup$K} for ions~\cite{saliba_spatial_2012}.
Using electrons also allows control of the bunch emittance as the excess energy can be controlled with the blue ionisation laser wavelength; with ions the change in emittance would be negligible.

See Chapter~\ref{chapter:setup} for a more detailed description of the \gls{caeis} and Figure~\ref{figure:emittance_schematic} for a schematic of the setup used for the measurements in this chapter.

\begin{figure}
\center
\includegraphics{part2/Figs/EmittanceApparatusSchematic.pdf}
\caption[Brightness measurement apparatus with dimensions.]{A schematic of the experimental apparatus with relevant dimensions. The blue region indicates the electron beam envelope. Note that components are not necessarily orientate realistically in this schematic (particularly the deflectors).}
\label{figure:emittance_schematic}
\end{figure}

\subsection{Beam Optics}
The quadrupole electron optics discussed in Section \ref{section:quadrupole} were use to reduce the astigmatism present in the electron beam as discussed in the aforementioned section.
The two-dimensional pepperpot provide another avenue to monitor the astigmatism of the beam because with an astigmatic beam the spacing of the beamlets on the detector are not the same along each axis as shown in Figure~\ref{figure:astigmatic_pepperpot}.
The Einzel lens was used when focusing was required.

\begin{figure}
    \center
    \input{part2/Figs/example_astigmatic_pepperpot.pgf}
    \caption[Pepperpot measurements with and without beam astigmatism correction.]{An example of the electron bunch after the pepperpot mask without the beam correction from the quadrupole lens. It is readily apparent that spacing of the beamlets is not the same for the $x$ and $y$ axes even though the spacing in the pepperpot mask were symmetric. This image is log scaled and the color scale is the same as that shown in Figure~\ref{figure:pepperpot_example}.}
    \label{figure:astigmatic_pepperpot}
    % From 2017.06.01, Set 1, 478.913nm
\end{figure}

A number of permanent magnets were used to steer the beam through the various apertures and onto the detector and care was taken to keep the beam on the central axis of the apparatus.
The static magnetic fields were configured manually by adjusting the positions of the magnets, which were mounted on posts external to the vacuum system.
Due to the unstable nature of the magnetic environment and the multiple simultaneous research projects these magnets needed to be adjusted on a day-to-day basis to maintain the beam path.

The Einzel lens was used to focus the beam to a diameter approximately the same as the diameter of the pepperpot mask, as indicated in Figure~\ref{figure:emittance_schematic}.
This focal arrangement was done to increase the divergence of the beamlets, making measurement easier, and to increase the electron flux transmitted through the pepperpot mask.
The Einzel lens voltage required for this was approximately \unit[4.8]{kV} and varied slightly with beam emittance, i.e. high emittance beams result in a larger beam size and thus required adjusting the Einzel lens voltage by \unit[$\pm$100]{V} to keep the beam diameter equal to the pepperpot mask diameter at the mask.

\subsection{Beam Energy}
In many emittance measurements the beam energy would not be a free parameter.
Emittance measurement would normally be used as a diagnostic for a specific system or scenario.
In this experiment there were a number of considerations in determining the optimal beam energy to use for pepperpot measurements such as measurement resolution, beam current and beam stability and we were able to vary the energy of the beam from a few hundred eV to \unit[11.7]{keV}.


The measurement resolution is affected by the beam energy.
For a given emittance (transverse momentum spread), at low beam energy the size of the beamlets will be larger and thus more apparent at the detector than for high beam energy.
Unfortunately the slower the beam the more fragile the alignment of the beam becomes with the \gls{caes}.
It was impossible to align a \unit[500]{eV} beam through the system to the detector and even had it been possible the stability of the beam would have been highly succeptible to the beam trajectory instabilities discussed in Section~\ref{section:stability}.
A relatively high beam energy of \unit[8]{keV} was used, providing robust beam alignment that was resistant to the transient changes in the magnetic environment and acceptable measurement resolution.

\subsection{Bellows}

The bellows provide an additional mechanism to control the resolution of the measurement by adjusting the propagation distance of the pepperpot beamlets and thus their size on the detector.
Once the strength of the Einzel lens had been set as described above the bellows were positioned such that the length of the streaks covered the majority of the detector.
The optimum propagation distance was found to be \unit[475]{mm}.

\subsection{Streaking}
The streaking was achieved using a pair of deflectors located after the pepperpot sample and aligned such that the one-dimensional pepperpots could be streaked across the detector.
For these measurements one deflector was grounded and the other given a time-varying voltage which was supplied in one of two ways:
\begin{itemize}
\item a fast ramp using a bipolar push-pull solid-state switch with a fixed transition time of \unit[10]{ns} and
\item a slower ramp using an amplified signal generator with a minimum transition of approximately \unit[10]{$\muup$s}.
\end{itemize}
An example of the voltage ramps is shown in Figure~\ref{figure:deflector_voltages}.
The slow ramp was performed by amplifying the output of the signal generator\footnote{Rigol DG4162, bandwidth \unit[160]{MHz}}, limited by the speed of the amplifier to a transition time minimum of approximately \unit[10]{$\muup$s} in duration as shown in Figure~\ref{figure:deflector_voltages}.
The streaking electrons were designed and constructed by fellow student Rory Speirs as described in Reference~\cite{speirs_electron_2017}.

\begin{figure}
    \center
    \input{part2/Figs/DeflectorVoltages.pgf}
    \caption[Streak deflector potential.]{The potentials applied to the deflectors for the long duration (left) and short duration (right) bunches. The zero on the time axis refers to the start of the electron bunches as shown in Figure~\ref{figure:streaks}.}
    \label{figure:deflector_voltages}
    % Code and data located in 2017.07.25, plot2error.py
\end{figure}

Synchronisation with the experimental cycle was achieved using triggers from the PulseBlaster, see Section~\ref{section:pulse_blaster}, and, while the PulseBlaster did not have sufficient temporal resolution to correctly trigger the fast ramp precisely, adjusting cable lengths for the trigger signal by a couple of metres provided adequate control.

An interesting effect that limited the length of the usable portion of fast streaks was `ringing' in the signal; shown in Figure~\ref{figure:ringing}.
Due to the ringing the range of the voltage sweep is truncated because any bunch with a duration longer than the sweep time would oscillate about the end point of the streak.
Fortunately the majority of the sweep is usable and bunches with duration shorter than the voltage sweep time are not affected.

\begin{figure}
    \center
    \input{part2/Figs/VoltagesRinging.pgf}
    \caption[Streak deflector voltage oscillations.]{An example of ringing in the fast deflector voltage sweep. On the left is the Voltage on the detector from the start of the electron bunch, notice the slow damping oscillation after the initial \unit[10]{ns} sweep. On the right is an example of a streaked emittance measurement for a relatively long bunch length, notice the oscillations corresponding to the `ringing' present in the deflector voltage located on the right side of the streak. This image is log scaled and the color scale is the same as that shown in Figure~\ref{figure:pepperpot_example}.}
    \label{figure:ringing}
    % Fast streak from 2017.06.11 Set 12, code in 2017.07.25, plot2.py
\end{figure}

\subsubsection{Calibration}
Calibration of the streak timing to the streak image was achieved with a calibration image of the electron bunch transmitted through the pepperpot mask minimum and maximum deflection, the voltage profile of the deflector during the streaking and assuming the streak position-time relation was linear.
The calibration image allows for the determination of the deflection-voltage gradient, $\frac{dx}{dV}$.
Any necessary transformations applied to the streaked pepperpot images, such as rotation and deskewing, were applied to the calibration image before measuring $dx$.
An example calibration image is shown in Figure~\ref{figure:example_calibration}.
The deflector voltage profile was measured with a \unit[1]{GHz} oscilloscope\footnote{Tektronix DPO4104B-L} with a probe attached directly to the vacuum feedthrough.
The voltage gradient, $\frac{dV}{dt}$, was measured by a linear fit to the streak region of the deflector voltage profile.
It was then simple to calculate the  deflection gradient for the image
\begin{equation}
\frac{dx}{dt} = \frac{dx}{dV} \frac{dV}{dt}.
\end{equation}

\begin{figure}
    \center
    \includegraphics[width=0.5\linewidth]{part2/Figs/example_calibration.jpeg}
    \caption[Streaked pepperpot calibration image.]{An example of an image used to calibrate the timing of the streaked pepperpots.
    This image is composed of the average of several images where the deflectors were at the minimum and maximum voltages. This image is log scaled and the color scale is the same as that shown in Figure~\ref{figure:pepperpot_example}.}
    % Set 9 2017.06.11
    \label{figure:example_calibration}
\end{figure}

The oscilloscope was also connected to a photodiode that monitored the intensity of the pulsed ionisation laser and this was used to determine the time during the voltage sweep that corresponds to the start of the streak.
The beam current of the short duration streaks correlates strongly with the intensity of the blue laser as shown in Figure~\ref{figure:blue_streak} which implies that the atom cloud is not saturated by the blue laser.

\begin{figure}
    \center
    \input{part2/Figs/blue_electrons.pgf}
    \caption[Comparison between time-resolved electron count and ionisation laser power.]{A comparison of the relative intensities of an unobstructed electron bunch focused and streaked across the detector and the blue laser pulse used to ionise the atoms.
    The top portion shows the streak of the electron bunch focused on the detector and streaked, the image is linearly scaled with a colour scale as indicated. The middle portion shows the intensity of the blue laser, and the bottom portion shows the electron count calculated by summation of each column of the streak image.}
    % 2017.04.12 - ThesisFigure.py
    \label{figure:blue_streak}
\end{figure}

\subsection{Pepperpots}
There were a number of iterations on the precise configuration of the one- and two-dimensional pepperpot masks used in these experiments.
The considerations when designing pepperpot masks were:
\begin{itemize}
    \item{\emph{Aperture size:} Smaller apertures provide a better resolution to the emittance measurement but reduce the signal, affects the beamlet overlap on the detector, allows for a smaller aperture spacings because when the aperture diameter and spacing are similar the pepperpot can become fragile.}
    \item{\emph{Aperture spacing:} Aperture spacing, also known as pitch, determines how well the full beam is sampled.
    Smaller pitch allows for better sampling but pitch should be large enough that the beamlet overlap on the detector can be corrected for, see Section~\ref{section:overlap_correction}.
    If the pitch is too small then the pepperpot can also become fragile.}
    \item{\emph{Extent:} Ideally the total extent of the pepperpot should be much larger than the largest beam for a particular apparatus.
    Unfortunately, due to the mounting arrangement the size of samples was limited to \unit[3]{mm} diameter and only a \unit[2]{mm} diameter portion of the sample was accessible to the beam, see Figure~\ref{figure:sample_holder_pepperpots}.}
\end{itemize}

There were a number of constraints on the pepperpot parameters.
The maximum extend of the pepperpot masks were limited to the diameter accessible by the beam, \unit[2]{mm}.
The need to maximise flux, by focusing the beam to the pepperpot size, and avoid excessive beamlet overlap at the detector also limited the minimum feasible pitch.
The pepperpots were machined\footnote{The pepperpots were cut using an Oxford Laser Systems Alpha 532 laser micromachining system.} from \unit[25]{$\muup$m} thick copper films\footnote{Gilder Grids GA50-C3, \unit[50]{$\muup$m} aperture.} with \unit[50]{$\muup$m} diameter holes.
A pitch of \unit[200]{$\muup$m} was chosen to provide acceptable sampling of the beam while minimising the overlap of beamlets on the detector.
Given the \unit[2]{mm} diameter available this pitch allowed for one dimensional pepperpots with 7 apertures and two dimensional pepperpots with 7$\times$7 apertures.
The pepperpots used are shown in Figures~\ref{figure:pepperpot_mask} and \ref{figure:1d_pepperpot}.

\begin{figure}
    \center
    \includegraphics[width=0.49\linewidth]{part2/Figs/sample_holder.jpg}
    \caption[Sample holder.]{Photo one of the sample holders that were used to load up to eight samples into the vacuum system. Clockwise from the top: five \unit[50]{$\muup$m} apertures with \unit[300]{$\muup$m} pitch, 7 by 7 pepperpot of \unit[50]{$\muup$m} apertures with \unit[200]{$\muup$m} pitch, 5 by 5 pepperpot of \unit[50]{$\muup$m} apertures with \unit[300]{$\muup$m} pitch, thin gold sample. Each sample is \unit[3]{mm} in diameter. A `lid' with appropriate apertures is placed over the samples to hold them in place leaving approximately \unit[2]{mm} diameter of each sample accessible to the beam.}
    \label{figure:sample_holder_pepperpots}
\end{figure}

\subsection{Laser Parameters}
The two-colour ionisation scheme required a \gls{cw} red excitation laser and a pulsed blue ionisation laser, see Section~\ref{section:two_stage_ionisation}.

\subsubsection{Excitation Laser}
The \unit[780]{nm} excitation laser was frequency locked to the Rb85 cooling transition.
The spatial profile of this laser was highly controllable with an \gls{slm} allowing for arbitrary profiles to be mapped to the electron or ion bunch~\cite{mcculloch_arbitrarily_2011}.
The highest electron flux could be obtained by simply saturating the \gls{mot} but that limits control over the electron beam profile and size.
One commonly used distribution is a flat-top which provided uniform electron intensity across the sample under examination.
If the electron beam emittance is high, as the beam propagates the beam profile will degrade to something closer to a Gaussian (see Figure~\ref{figure:flat_top}).

\begin{figure}
    \center
    \input{part2/Figs/flattops_emittance.pgf}
    \caption[Blurring of flat-top electron profile with emittance.]{Images of electron beams that are unobstructed and not focused. The beams are generated with a flat-top profile on the excitation laser with varying ionisation laser wavelengths, and thus excess energies. The excess ionisation energy is listed above each beam profile. Below each profile is a trace of the central row of pixels (indicated by the dashed white line). The images are linearly scaled with and the colour scale is the same as that in Figure~\ref{figure:blue_streak}.}
    \label{figure:flat_top}
    % Data and code at 2017.05.09
\end{figure}

If the electron beam has a simple, non-uniform spatial distribution, such as a Gaussian, then the specifics of the beam profile can be extrapolated from the pepperpot images allowing for further metrics to be calculated such as beam size and total electron count.
A Gaussian distribution also maintains a similar profile with propagation even for high emittance beams.
An example is shown in Figure~\ref{figure:pepperpot_profile}.
The rows and columns of the pepperpot image can be summed to generate a one-dimensional set of beamlets.
From the amplitude and standard deviation of each beamlet the total number of electrons in each beamlet can be calculated and this corresponds to the number of electrons that passed through the corresponding aperture.
Ideally the apertures would sample the full beam and the Gaussian fitted to the beamlets is an approximation of the full beam profile and the beam size and electron count can be determined.

\begin{figure}
    \center
    \input{part2/Figs/beam_size.pgf}
    \caption[Determining the beam profile from a pepperpot measurement.]{Left: image of electrons propagated through a 7$\times$7 pepperpot with a below-threshold low-emittance electron bunch.
    Centre: column sum of the pixels in the first image for which the amplitude and standard deviation are calculated for each of the seven peaks.
    Right: black line indicates the shape of the pepperpot in one-dimension, the blue crosses indicate the total number of electrons in each of the seven, column-summed, beamlets and the red line indicates a Gaussian fitted to the beamlet electron counts and represents the full profile of the electron bunch incident on the pepperpots.}
    \label{figure:pepperpot_profile}
    % Data and code at 2017.06.06
\end{figure}

\subsubsection{Ionisation Laser}
A 457 to \unit[493]{nm} \unit[5]{ns} pulsed laser\footnote{Sirah dye laser system CSTR-D-3000.} was used to ionise atoms in the 5P excited state.
The wavelength could be tuned to select various ionisation pathways such as above-threshold ionisation or field ionisation.
The ionisation pathway selected affects the duration of the bunch produced.
Above threshold ionisation resulted in short bunches with durations the same as the duration of the ionisation laser and below threshold ionisation in much longer bunches with durations of \unit[10s]{$\muup$s} due to electrons tunnelling out after the end of the ionisation pulse.

The ionisation laser wavelength also affected the excess electron energy and transverse momentum spread and thus the emittance of the electron bunches.
This is discussed in Sections~\ref{section:two_stage_ionisation} and \ref{section:excess_energy_emittance}.

\section{Simulations}\label{section:pepperpot_simulations}

Due to experimental constraints including the low beam flux, pepperpot mask size and beamlet overlap it was not possible to engineer an ideal setup of beam and pepperpot parameters.
The non-ideal experimental parameters cause some distortions to the emittance measurements so simulations were performed to explore the effects and verify the validity of the corrections.
These simulations also proved to be a useful confirmation of the analysis procedure used on the experimental data.

The simulations were performed using simple homemade particle tracking code.
The code allowed for arbitrary bunch profiles and pepperpot masks defined in one and two dimensions.

A Gaussian bunch profile was used and the emittance of the bunch was set to a range of values similar to those achievable with the actual apparatus.
The path of the bunch was designed to replicate that of the \gls{caeis} by propagating the bunch to a lens, then to a pepperpot mask and finally to a detector.
The lens was implemented by applying a radially dependent velocity change to the particles in order to focus the beam such that the beam size was the same as the size of the pepperpot mask, approximately \unit[2]{mm}.

\subsection{Pepperpot Aperture Size}

The first set of simulations investigated the effects of aperture size on the emittance measurement.
The procedure outline in Reference~\cite{zhang_emittance_1996}, which formed the foundation of the analysis used here, assumes that the size of the apertures used is negligible compared to the divergence of the particles.
Due to the low electron flux it is not feasible to use pepperpots with negligibly small holes so it is necessary to understand and correct for finite aperture size.

The profile of a beamlet is a convolution of the aperture profile and the beamlet profile from an infinitesimally small aperture.
Thus, when the aperture size is large compared to the effects of the beam divergence, it will be difficult to determine the divergence whereas if the divergence effect is similar or large compared to the aperture size then the divergence will be easier to determine.
This results in an overestimation of beam divergence when the divergence and aperture size are similar and a minimum measurable divergence, and thus emittance, if the divergence is much smaller than the aperture size.
An example of a resolution limit for this experiment is shown in Figure~\ref{figure:wavelength_sim}.

The correction for finite apertures, where the aperture is not too large compared to the effect of the divergence, is to deconvolve the aperture size from the beamlet profile which is most easily implemented by fitting the width of a Gaussian convolved with the aperture size to the known beamlet size, taking magnification into account.
Reapplying the magnification to the result of the fit supplies the profile of beamlets had the apertures been infinitesimally small.

The results of the analysis of simulations that vary the size of the apertures is shown in Figure~\ref{figure:aperture_size_sim}, and the improvement in the accuracy of the analysis when the aperture size correction is applied is evident.

\begin{figure}
\begin{subfigure}[b]{\textwidth}
    \center
    \input{part2/Figs/wavelength_sweep_sim.pgf}
    \caption[Results of a simulation investigating the efficacy of the aperture size correction for various electron excess energies.]{Simulated emittance measured as excess ionisation energy is varied for the electron bunch.
    The pepperpot mask had \unit[50]{$\muup$m} diameter apertures with an extent much larger than the beam size and there was negligible beam overlap.
    The blue and green lines are the results without and with aperture size correction.
    The red line is the theoretical emittance given by Equation~\ref{equation:excess_energy_temperature}.
    The resolution limit of the mask is apparent with excess energies less than \unit[10]{meV}.}
    \label{figure:wavelength_sim}
    % Data and code located in Code/Electrons/Simulation/1D Simulation SimScript1D.py - Wavelength Sweep
\end{subfigure}

\begin{subfigure}[b]{\textwidth}
    \center
    \input{part2/Figs/aperture_size_sim.pgf}
    \caption[Results of a simulation investigating the efficacy of the aperture size correction for various aperture sizes.]{Simulated emittance measured as the size of the pepperpot apertures is varied. The blue and green lines are the results without and with the aperture size correction. The dotted black line is the true emittance of the bunch being simulated.}
    \label{figure:aperture_size_sim}
    % Data and code located in Code/Electrons/Simulation/1D Simulation SimScript1D.py
\end{subfigure}
    \caption[Results of a simulations investigating the efficacy of the aperture size correction for various excess energies and aperture sizes.]{}
\end{figure}

\subsection{Beamlet Overlap}\label{section:overlap_correction}
Most pepperpot analysis procedures assume that the beamlets are completely separated which was difficult to achieve with this apparatus while providing sufficient flux for streaked measurements and enough sampling of the beam to allow for estimation of the full-beam profile.
A na\"ive analysis of overlapped beamlets might just analyse the potion of the beamlet between the troughs in the signal, but that would results in an underestimate of the beamlet size due to the portion overlapping the neighbouring beamlets.
The method used here is to fit the sum of $N$ Gaussians, where $N$ is the number of beamlets, to the data.

Shown in Figure~\ref{figure:overlap_example} is an example of overlapped beamlets, and the improvement in the emittance measurement from the na\"ive approach to the fitting is clear in this example.
The results of the na\"ive approach can be used as a guess for the fitting of the more detailed method.
Most of the measurements made during this project have a lower degree of overlap than that demonstrated in Figure~\ref{figure:overlap_example} and have a much smaller deviation from the correct emittance but the correction was still made to provide a small improvement in the accuracy of the analysis.

\begin{figure}
    \center
    \input{part2/Figs/OverlapExample.pgf}
    \caption[An example of overlapping beamlets.]{Simulated one-dimensional pepperpot emittance measurement, demonstrating overlapping beamlets.
    The left figure shows overlapping beamlets from simulated one-dimensional data (shown as a dotted line in the other figures), the middle figure shows nine Gaussian fits to each beamlet, and the summation of those fits, derived by considering only the portion of each beamlet between the troughs in the distribution, and the right figure shows nine Gaussian fits from fitting the sum of nine Gaussians to the data.
    The actual emittance of the simulated bunch is listed in the left figure and the emittance derived from the Gaussian sets is listed in the other two figures.
    In the second two figures the pale lines indicate individual Gaussians fitted for each beamlet and solid lines for the sum of the individual Gaussians.}
    \label{figure:overlap_example}
    % Data and code located in Code/Electrons/Simulation/1D Simulation SimScript1D.py and OverlapExample.py
\end{figure}


\subsection{Pepperpot Extent and Beam Coverage}
A pepperpot mask that has an extent smaller than the size of the beam is sampling only a portion of the beam and provides an underestimation of the beam emittance.

The emittance of a beam depends on the beam width (see Equations~\ref{emittance} and \ref{equation:excess_energy_emittance}).
If for example, a pepperpot measures only half of a flat-top uniform distribution beam, then the measured value with be half the full emittance of the beam.
The correction is more complicated for a Gaussian profile beam as the emittance is proportional to the integral of the normalised Gaussian covered by the pepperpot.
If the beam shape in the pepperpot plane can be described by a Gaussian function $f_{\bar{x},\sigma}(x)$ then the true emittance should be
\begin{equation}
\epsilon_t = \epsilon_m \int_{-E}^{E} f_{\bar{x}, \sigma}(x) dx,
\end{equation}
where $\epsilon_m$ is the measured uncorrected emittance and the pepperpot extends from $-E$ to $+E$.
The simulations indicate that the reality is not this simple.
From detailed simulations it was determined that a better estimate can be obtained using
\begin{equation}
\epsilon_t = \epsilon_m \int_{-0.75*E}^{0.75*E} f_{\bar{x}, \sigma}(x) dx.
\end{equation}
The factor of 0.75 was discovered by fitting to the simulated data.
There is clearly some aspect of this correction that is not yet understood but it performs adequately for use with the measurements in this chapter.
The performance of the correction is shown in Figure~\ref{figure:pepperpot_extent}.
The correction performs well until the pepperpot extent approaches the \gls{rms} width of the beam at which point the beam size estimations become less reliable.

{\color{red}
Try and figure out what's going on with the magic number.
}

\begin{figure}
    \center
    \input{part2/Figs/PepperpotExtent.pgf}
    \caption[Results of a simulation investigating the efficacy of the beam coverage correction for various beam sizes.]{Simulated emittance as the extent of the pepperpot mask coverage of the beam is varied.
    The red dotted line indicates the true emittance of the bunch, the blue line indicates the measured emittance of the bunch without the beam coverage correction and the green line is the measured emittance with the correction.
    The dotted black line indicates the \gls{rms} width of the beam at the pepperpot plane (\unit[873]{$\muup$m}).}
    \label{figure:pepperpot_extent}
    % Data and code located in Code/Electrons/Simulation/1D Simulation SimScript1D.py
\end{figure}

\section{Brightness Measurements}
To demonstrate the feasibility of time-resolved brightness measurements a number of measurements have been made including a comparison of two-dimensional pepperpot emittance measurements with theory and simulation, and one-dimensional pepperpot streaked measurements with long and short duration electron bunches.

\subsection{Analysis}
The analysis procedure developed was based on the theory described in Reference~\cite{zhang_emittance_1996} and Equation~\ref{equation:pepperpot}.
To determine the emittance from a one dimensional pepperpot measurement a number of parameters are required:
\begin{itemize}
    \item Size of pepperpot apertures
    \item Position of pepperpot apertures
    \item Size of beamlets on the detector
    \item Position of beamlets on the detector
    \item Total number of electrons in each beamlet
\end{itemize}
The pepperpot parameters are known from the fabrication and the beamlet parameters can be determined from appropriately prepared two-dimensional and streaked one-dimensional pepperpot measurements.
The analysis procedure is as follows:
\begin{enumerate}
    \item Acquire electron projection images
    \item Register images (see Section~\ref{section:registration})
    \item Average registered images
    \item Rotate image so dominant features are aligned with the pixel rows
    \item Deskew image so features along the second axis align with the columns
    \begin{itemize}
        \item For two dimensional pepperpots, sum the rows and columns separately to produce two one-dimensional sets of beamlets
        \item For streaked emittance measurements, consider each column of pixels independently as a one-dimensional sets of beamlets.
    \end{itemize}
    \item Determine the approximate amplitude, mean position and \gls{rms} width of each beamlet
    \item Refine the amplitude, mean position and \gls{rms} width of each beamlet by fitting a number of Gaussians equal to the number of beamlets to the beamlet set to account for any overlap
    \item Transform the beamlet position and width measurements from pixel measurement to detector-plane measurements using the camera and \gls{mcp} calibration
    \item Fit a Gaussian convolved with the aperture size to the refined beamlet parameters in order to determine the equivalent beamlet for an infinitesimal aperture
    \item Use Equation~\ref{equation:pepperpot} to determine the emittance
    \item Estimate the full-beam profile of the bunch by fitting a Gaussian to the number of particles transmitted through each aperture (equal to the total particle count for each beamlet)
    \item Correct the emittance by considering the beam coverage of the pepperpot mask given the full-beam profile
    \item Use the beam profile to determine the beam current
    \item Use the beam current and emittance to determine the brightness
\end{enumerate}


\subsection{Calibrations}
A number of experimental parameters require calibration and the procedures for doing so are briefly outlined here.

\subsubsection{Detector-Camera Calibration}
The detector for the \gls{caeis} consists of a phosphor-coupled \gls{mcp} observed with a \gls{ccd} camera.
In order to relate distance in the images, measured in pixels, to distances on the phosphor screen, measured in meters, it is necessary to calibrate the camera.
This is easily achieved by placing a reliable ruler alongside the phosphor screen and taking an image which the number of pixels corresponding to a distance on the ruler, and thus the phosphor screen, to be determined.
The calibration was found to be \unit[24.5]{pixels per mm}.

\subsubsection{Electron-\gls{mcp}-Camera Calibration}
The number of camera counts generated by a single electron is another required calibration.
This is achieved by focusing a beam on to the Faraday cup that can be inserted into the beamline and measuring the number of electrons per bunch followed by removing the cup, unfocusing the beam and recording an image.
The total number of counts on the image can then be compared to the known number of electrons in the bunch.
To reduce the uncertainty in this measurement the number of electrons can be varied by adjusting the power of the red excitation laser.
The calibration was found to be 34.3 counts per electron.

This process was performed with the \gls{mcp} voltage at \unit[1.7]{kV} and the phosphor voltage at \unit[4.0]{kV} and all the measurement shown in this chapter use those parameters.

\subsubsection{Source Size}
Another required parameter is the size of the source which is required to determine the expected emittance using Equation~\ref{equation:excess_energy_emittance}.
The transverse source size was the same size as the excitation laser as it passed through the \gls{mot}.
This was determined by intercepting the excitation laser with a mirror and directing the beam onto a camera placed the same distance away from the intercepting mirror as the centre of the chamber in which the \gls{mot} was located.
Knowing the size of pixels for the camera allowed for the spatial profile of the beam to be determined.
The source size was determined to be \unit[450.8]{$\muup$m} in the vertical direction and \unit[690.6]{$\muup$m} in the horizontal direction.

However by fitting Equation~\ref{equation:excess_energy_emittance} to the data shown in Figure~\ref{figure:emittance_vs_theory} it was apparent that the source size was closer to \unit[340]{$\muup$m} indicating that the \gls{mot} is no longer located in the centre of the chamber and thus that the position at which the laser beam profile was measured was not comparable.
Slow changes in the position of the \gls{mot} were likely due to alignment drift given the age of the apparatus.

\subsection{Two-Dimensional Pepperpots}
The frequency of the ionisation laser could be tuned to control the emittance of electron bunches as it determined the excess energy of bunches.
Varying the wavelength of the ionisation laser and measuring the emittance of the electron bunches using the two dimensional pepperpot allowed for testing of the emittance measurement system and analysis as the results could be compared to the theory described by Equation~\ref{equation:excess_energy_emittance} and the simulations in Section~\ref{section:pepperpot_simulations}.

The results from this test can be seen in Figure~\ref{figure:emittance_vs_theory} and the results are well matched to the theory and previous measurements of the emittance of this \gls{caes}~\cite{mcculloch_high-coherence_2013}.
The data are taken from 100-shot registered averages and agrees with the simulation results.
The lower bound on measurable emittance is apparent in both the measurement and the simulation results.
Due to the aperture size of \unit[50]{$\muup$m} and beam path geometry (propagation distances, focusing parameter, etc.) the measurements were limited to resolving emittance greater than \unit[41]{nm rad}.

\begin{figure}
    \center
    \input{part2/Figs/emittance_vs_theory.pgf}
    \caption[Measured emittance compared with theory and simulation.]{Emittance of electron bunches produced by the \gls{caes} (blue) compared to theoretical predictions of Equation~\ref{equation:excess_energy_emittance} (red), and the results of analysis of simulation (green) as the excess energy is varied. The black dotted lines indicate the excess energy of the two streaks shown in Figure~\ref{figure:streaks}.}
    \label{figure:emittance_vs_theory}
    % Data and code located in 2017.06.06, Analyse.py
\end{figure}


\subsection{Streaked One-Dimensional Pepperpots}\label{section:streaked_pepperpot_results}
Shown in Figure~\ref{figure:streaks} are examples of time-resolved brightness measurements from streaked one-dimensional pepperpots.
The streaks were formed from long- and short-duration electron bunches produced from the \gls{caes} with below and above-threshold ionisation and the images created from 1000-shot registered averages.
The long-duration bunch was generated with a blue ionisation laser wavelength of \unit[487.2]{nm} corresponding to an excess ionisation energy of \unit[$-$43.25]{meV}, below-threshold ionisation and a bunch duration of order \unit[10]{$\muup$s}.
The short-duration bunch was generated with a blue wavelength of \unit[475.9]{nm} with an excess energy of \unit[17.18]{meV}, resulting in above-threshold ionisation and a bunch duration of \unit[5]{ns}.
These wavelengths were carefully chosen provide good demonstrations of streaking of long- and short-duration bunches.

\begin{figure}
    \center
    \input{part2/Figs/streaks.pgf}
    \caption[Streaked brightness measurements for $\muup$ and ns timescales.]{Long (left) and short (right) duration electron bunch streaked pepperpot measurements showing, from top to bottom, the false-colour streak image, full-beam current, normalised \gls{rms} emittance, and normalised brightness. The dotted black lines indicate the start of the electron bunches. The red dotted lines in the emittance measurement indicate the expected emittance from the simulations discussed in Section~\ref{section:pepperpot_simulations}. The shaded regions indicate the standard deviation of ten 100-shot measurements.}
    \label{figure:streaks}
\end{figure}

\subsubsection{Measurement Resolution}
The temporal resolution of these measurements in dictated by a number of factors ;the finite \gls{psf} of the detector, the gradient or `slew' of the deflector voltages and the size of the beamlets on the detector.
The \gls{ccd} camera and lens used to take images of the detector is assumed to have a resolution much better than the point spread function of the phosphor screen.

The \gls{psf} of the \gls{mcp} and phosphor screen is approximately Gaussian with a standard deviation of \unit[35]{$\muup$m} and is measured by examining single electron events on the detector~\cite{speirs_electron_2017}.
The streak calibration images (such as Figure~\ref{figure:example_calibration}) can be used as a simple measure for the size of the detected beamlets, which are a convolution of the beamlets size at the detector and the \gls{psf} of the detector.
The detected beamlets tend to have a size with an \gls{rms} around \unit[183]{$\muup$m} although this does vary with the emittance of the beam.
The majority of the signal from an electron is therefore contained within an area of four times the standard deviation or \unit[732]{$\muup$m} and thus the long- and short-duration streaks shown in Figure~\ref{figure:streaks} can be sliced into 27 and 18 temporal slices which correspond to time resolutions of \unit[524]{ns} and \unit[247]{ps} respectively.

The temporal resolution can be enhanced by carefully maximising the size of the streak on the detector, by using faster electronics, or by using alternative methods such as rf-cavities or photoactivated switches which are able to achieve \unit[100]{fs} resolution~\cite{li_note:_2010,kassier_compact_2010,van_rens_theory_2018}.
Ensuring that the streak takes up the maximum available extent on the detector minimises the effect of the \gls{psf} on the temporal resolution with the downside that signal is now spread over a wider area thus reducing the \gls{snr}.

\subsection{Electron Flux}
The current electron flux of the \gls{caes} is not sufficient to perform the streaked emittance measurement in a single-shot and in some scenarios (such as ionisation pathways with poor coupling) the signal is so low that registration of measurements cannot be performed making those measurements impossible.

In order to perform these measurement with the same \gls{snr} would require 1000 times as many electrons per bunch, or $10^8$ electrons, since these measurements are composed of 100-shot averages.
Certain photocathode sources are able to achieve electron counts of order $10^8$ electrons per bunch and thus these techniques could perform equivalent measurements in a single shot and thus prove useful for beam diagnostics for these sources~\cite{li_note:_2010,musumeci_high_2010}.
There are a number of strategies available to the \gls{caes} to improve the number of electron per shot such as increasing the \gls{mot} density, optimising the ionisation pathways, and using a higher intensity blue ionisation laser.

\section{Conclusion}
This chapter has presented the first demonstration of time-resolved brightness measurements using streaked pepperpots.
The technique was developed to observe time-varying effects during the ionisation and extraction of electrons from a \gls{caes} but the results show that the emittance over the duration of the bunches is constant, indicating that there are no time-dependent effects on source emittance, such as hotter electrons produced through alternative ionisation pathways like multi-photon ionisation~\cite{speirs_identification_2017}.
The measured emittance of the bunches correlates well with the results of simulation and theory with the below-threshold bunch measurements being limited by the minimum resolvable emittance of the apparatus.

This technique has promise for use in a wide range of charged particle beam sources and is widely applicable to a range of scenarios.
With a sufficiently high-current source, such as photocathode electron sources, this technique can also be used to perform measurements in a single-shot.
With the next generation of \gls{caeis} currently under development this technique could be refined with less constrained apparatus, provide interesting insights into the ionisation processes involved and enhance work on achieving \gls{ued}.
Time-resolved brightness measurements through the streaking of one-dimensional pepperpots have the potential to provide information on the behaviour of many charged particle sources, allow for a better understanding of the physics involved and suggest pathways towards improvement to these sources.
